<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Android,UI,知识架构,自定义View,">










<meta name="description" content="第一章 入门基本类熟悉第1节 CanvasCanvas 使用方法概述 drawXXX() -&amp;gt; 绘制基本图形类方法：  clipRect()  -&amp;gt; 类似于现实中的A4画纸裁剪 save(), restore(), rotate() translate() -&amp;gt; 可以联想现实中把画纸移动、旋转找的合适的下笔位置，在回复位置  方法举例drawRoundRect(float lef">
<meta name="keywords" content="Android,UI,知识架构,自定义View">
<meta property="og:type" content="article">
<meta property="og:title" content="自定义View知识架构体系">
<meta property="og:url" content="http://linz.tech/2019/09/15/2019-9-15-custom_view_note/index.html">
<meta property="og:site_name" content="北疆的博客">
<meta property="og:description" content="第一章 入门基本类熟悉第1节 CanvasCanvas 使用方法概述 drawXXX() -&amp;gt; 绘制基本图形类方法：  clipRect()  -&amp;gt; 类似于现实中的A4画纸裁剪 save(), restore(), rotate() translate() -&amp;gt; 可以联想现实中把画纸移动、旋转找的合适的下笔位置，在回复位置  方法举例drawRoundRect(float lef">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-6afab7adc9d61dde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-e8de6903504eec1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-d7c318273bf16c36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://cdn.linz.tech/ANTI_ALIAS_FLAG.jpg">
<meta property="og:image" content="http://cdn.linz.tech/android_cap_join_2019-09-14_15-13-37.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-a81268e6753051a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-ca3f53229a8b133d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://cdn.linz.tech/android_blog_paint_Miter.jpg">
<meta property="og:image" content="http://cdn.linz.tech/android_blog_paint_Miter_value.jpg">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-a310e93aeb2e116e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-4bfa331febf3c829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-cdfbd2bc9b21ffbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://cdn.linz.tech/PorterDuff_2019-09-14_21-36-30.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-6cfc0b62238227a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-ef369f4f26f04e5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-046df21da3e17477.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-66679606910e82c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-a37b819668c0aebb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-d43de1a91d8aa955.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-19a364da5ab1d0ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-aec59eb38640c0f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-4385d6a94519b1ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://cdn.linz.tech/android_ondraw_2019-09-14_15-13-37.png">
<meta property="og:image" content="http://cdn.linz.tech/android_blog_drawText.jpg">
<meta property="og:image" content="http://ws2.sinaimg.cn/large/006tKfTcly1fjn0huxdm5j30lr0q0n25.jpg">
<meta property="og:image" content="http://cdn.linz.tech/0A7EBEC3.jpg">
<meta property="og:image" content="http://cdn.linz.tech/android_theme_base_ui.png">
<meta property="og:image" content="http://cdn.linz.tech/android_attr_level2019-09-14_10-23-21.png">
<meta property="og:image" content="http://ws1.sinaimg.cn/large/006tKfTcgy1fj7x3rm1xxj30u50laq6y.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/MasayukiSuda/EasingInterpolator/master/art/easing.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-6a6533d24b09bf74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-28dbe5083f4f1c2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-bb097e636dd027e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://cdn.linz.tech/android_view_location.png">
<meta property="og:image" content="https://raw.githubusercontent.com/chengdazhi/StyleImageView/master/images/style_sample.gif">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-02b7186177129852.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-e7aad3fae62f26d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-801e00469b2602c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-40c2c0171a7c1892.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-fa91852954be9f0f.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-5030edba20a127c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-41c26887d58f3f4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-7c44d124a04d43e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-fab59160fd493e92.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-f0e11fa6b7745197.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-e553f979470b591c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1321512-367aeaac082c40a1.gif?imageMogr2/auto-orient/strip">
<meta property="og:updated_time" content="2020-12-04T02:06:03.260Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="自定义View知识架构体系">
<meta name="twitter:description" content="第一章 入门基本类熟悉第1节 CanvasCanvas 使用方法概述 drawXXX() -&amp;gt; 绘制基本图形类方法：  clipRect()  -&amp;gt; 类似于现实中的A4画纸裁剪 save(), restore(), rotate() translate() -&amp;gt; 可以联想现实中把画纸移动、旋转找的合适的下笔位置，在回复位置  方法举例drawRoundRect(float lef">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1321512-6afab7adc9d61dde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'CD2IHLO3Q2',
      apiKey: 'f3890b1e9cf212771f29d3258b186372',
      indexName: 'LocalSearch',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://linz.tech/2019/09/15/2019-9-15-custom_view_note/">





  <title>自定义View知识架构体系 | 北疆的博客</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?dd275ba96bfa28cb8bd3809466f17419";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>





<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">北疆的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br>
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://linz.tech/2019/09/15/2019-9-15-custom_view_note/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="北疆">
      <meta itemprop="description" content>
      <meta itemprop="image" content="http://cdn.linz.tech/a.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="北疆的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">自定义View知识架构体系</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-15T09:02:53+08:00">
                2019-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/note/" itemprop="url" rel="index">
                    <span itemprop="name">note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/09/15/2019-9-15-custom_view_note/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2019/09/15/2019-9-15-custom_view_note/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>次
            </span>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="第一章-入门基本类熟悉"><a href="#第一章-入门基本类熟悉" class="headerlink" title="第一章 入门基本类熟悉"></a>第一章 入门基本类熟悉</h1><h2 id="第1节-Canvas"><a href="#第1节-Canvas" class="headerlink" title="第1节 Canvas"></a>第1节 Canvas</h2><h3 id="Canvas-使用方法概述"><a href="#Canvas-使用方法概述" class="headerlink" title="Canvas 使用方法概述"></a>Canvas 使用方法概述</h3><ul>
<li>drawXXX() -&gt; 绘制基本图形类方法： </li>
<li><strong>clipRect</strong>()  -&gt; 类似于现实中的A4画纸裁剪</li>
<li>save(), restore(), rotate() translate() -&gt; 可以联想现实中把画纸移动、旋转找的合适的下笔位置，在回复位置</li>
</ul>
<h3 id="方法举例"><a href="#方法举例" class="headerlink" title="方法举例"></a>方法举例</h3><p>drawRoundRect(float left, float top, float right, float bottom, float rx, float ry, Paint paint)  画圆角矩形</p>
<p>drawArc(float left, float top, float right, float bottom, float startAngle, float sweepAngle, boolean useCenter, Paint paint) 绘制弧形或扇形</p>
<ul>
<li><code>startAngle</code> 是弧形的起始角度（x 轴的正向，即正右的方向，是 0 度的位置；顺时针为正角度，逆时针为负角度）</li>
<li><code>useCenter</code> 表示是否连接到圆心，如果不连接到圆心，就是弧形，如果连接到圆心，就是扇形。</li>
</ul>
<ol>
<li><h4 id="Canvas-scale-float-sx-float-sy-float-px-float-py-放缩"><a href="#Canvas-scale-float-sx-float-sy-float-px-float-py-放缩" class="headerlink" title="Canvas.scale(float sx, float sy, float px, float py) 放缩"></a>Canvas.scale(float sx, float sy, float px, float py) 放缩</h4></li>
<li><h4 id="skew-float-sx-float-sy-错切"><a href="#skew-float-sx-float-sy-错切" class="headerlink" title="skew(float sx, float sy) 错切"></a>skew(float sx, float sy) 错切</h4></li>
<li><h4 id="Matrix-来做自定义变换"><a href="#Matrix-来做自定义变换" class="headerlink" title="Matrix 来做自定义变换"></a>Matrix 来做自定义变换</h4><pre class="line-numbers language-java"><code class="language-java">Matrix matrix <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Matrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">float</span> pointsSrc <span class="token operator">=</span> <span class="token punctuation">{</span>left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> top<span class="token punctuation">,</span> left<span class="token punctuation">,</span> bottom<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">}</span><span class="token punctuation">;</span>  
<span class="token keyword">float</span> pointsDst <span class="token operator">=</span> <span class="token punctuation">{</span>left <span class="token operator">-</span> <span class="token number">10</span><span class="token punctuation">,</span> top <span class="token operator">+</span> <span class="token number">50</span><span class="token punctuation">,</span> right <span class="token operator">+</span> <span class="token number">120</span><span class="token punctuation">,</span> top <span class="token operator">-</span> <span class="token number">90</span><span class="token punctuation">,</span> left <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> bottom <span class="token operator">+</span> <span class="token number">30</span><span class="token punctuation">,</span> right <span class="token operator">+</span> <span class="token number">20</span><span class="token punctuation">,</span> bottom <span class="token operator">+</span> <span class="token number">60</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

matrix<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
matrix<span class="token punctuation">.</span><span class="token function">setPolyToPoly</span><span class="token punctuation">(</span>pointsSrc<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pointsDst<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>matrix<span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ol>
<h3 id="Canvas图层的概念"><a href="#Canvas图层的概念" class="headerlink" title="Canvas图层的概念"></a>Canvas图层的概念</h3><p>主要方法</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//新建图层</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">saveLayer</span><span class="token punctuation">(</span><span class="token keyword">float</span> left<span class="token punctuation">,</span> <span class="token keyword">float</span> top<span class="token punctuation">,</span> <span class="token keyword">float</span> right<span class="token punctuation">,</span> <span class="token keyword">float</span> bottom<span class="token punctuation">,</span> Paint paint<span class="token punctuation">,</span> <span class="token keyword">int</span> saveFlags<span class="token punctuation">)</span>
<span class="token comment" spellcheck="true">//切换到指定图层的上一级图层</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">restoreToCount</span><span class="token punctuation">(</span><span class="token keyword">int</span> saveCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment" spellcheck="true">//获取图层数量</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getSaveCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>drawBitmapMesh(Bitmap bitmap, int meshWidth, int meshHeight, float[] verts, int vertOffset, int[] colors, int colorOffset, Paint paint)  </p>
<p><strong>第二是以clipXXX为主的裁剪方法</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token function">clipPath</span><span class="token punctuation">(</span>Path path<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op op<span class="token punctuation">)</span>  
<span class="token function">clipRect</span><span class="token punctuation">(</span>Rect rect<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op op<span class="token punctuation">)</span>  
<span class="token function">clipRect</span><span class="token punctuation">(</span>RectF rect<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op op<span class="token punctuation">)</span>  
<span class="token function">clipRect</span><span class="token punctuation">(</span><span class="token keyword">float</span> left<span class="token punctuation">,</span> <span class="token keyword">float</span> top<span class="token punctuation">,</span> <span class="token keyword">float</span> right<span class="token punctuation">,</span> <span class="token keyword">float</span> bottom<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op op<span class="token punctuation">)</span>  
<span class="token function">clipRegion</span><span class="token punctuation">(</span>Region region<span class="token punctuation">,</span> Region<span class="token punctuation">.</span>Op op<span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>Region.Op参数<br><img src="http://upload-images.jianshu.io/upload_images/1321512-6afab7adc9d61dde.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>与图片的混合模式一样</li>
<li>Region和Rect有什么区别<ul>
<li>Region表示的是一个区域，而Rect表示的是一个矩形</li>
<li>Region有个很特别的地方是它不受Canvas的变换影响，Canvas的local不会直接影响到Region自身。</li>
</ul>
</li>
</ul>
<p><strong>第三是以scale、skew、translate和rotate组成的Canvas变换方法</strong></p>
<ul>
<li><strong>translate(float dx, float dy) 会改变画布的原点坐标</strong> </li>
<li>scale(float sx, float sy, float centerX, float centerY)</li>
</ul>
<p><strong>最后一类则是以saveXXX和restoreXXX构成的画布锁定和还原</strong></p>
<ul>
<li>saveLayer<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">int</span> sc <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">saveLayer</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> screenW<span class="token punctuation">,</span> screenH<span class="token punctuation">,</span> null<span class="token punctuation">,</span> Canvas<span class="token punctuation">.</span>ALL_SAVE_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>   将绘制操作保存到新的图层
canvas<span class="token punctuation">.</span><span class="token function">restoreToCount</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
<li>canvas.saveLayerAlpha(0, 0, canvas.getWidth(), canvas.getHeight(), 75, Canvas.ALL_SAVE_FLAG); // 锁定画布并设置画布透明度为75%  </li>
<li>restoreToCount(int saveCount)方法来指定在还原的时候还原哪一个保存操作.</li>
<li>Canvas中有六个常量值：<br><img src="http://upload-images.jianshu.io/upload_images/1321512-e8de6903504eec1c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><ul>
<li>有LAYER单词的只能saveLayerXX方法使用，其他通用。</li>
<li>ALL_SAVE_FLAG 保持所有/CLIP_SAVE_FLAG保持剪裁/MATRIX_SAVE_FLAG 保持变换</li>
<li>CLIP_TO_LAYER_SAVE_FLAG 当前图层执行裁剪操作需要对齐图层边界</li>
<li>FULL_COLOR_LAYER_SAVE_FLAG  当前图层的色彩模式至少需要是8位色</li>
<li>HAS_ALPHA_LAYER_SAVE_FLAG 当前图层中将需要使用逐像素Alpha混合模式 <a href="http://blog.csdn.net/aigestudio/article/details/42677973" target="_blank" rel="noopener">色彩深度和Alpha混合 wiki</a></li>
</ul>
</li>
<li>save和saveLayerXXX方法<blockquote>
<p>save和saveLayerXXX方法有着本质的区别，saveLayerXXX方法会将所有操作在一个新的Bitmap中进行，而save则是依靠stack栈来进行</p>
</blockquote>
</li>
</ul>
<pre class="line-numbers language-java"><code class="language-java"><span class="token annotation punctuation">@Override</span>  
<span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true">/* 
     * 保存并裁剪画布填充绿色 
     */</span>  
    <span class="token keyword">int</span> saveID1 <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>Canvas<span class="token punctuation">.</span>CLIP_SAVE_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    canvas<span class="token punctuation">.</span><span class="token function">clipRect</span><span class="token punctuation">(</span>mViewWidth <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">-</span> <span class="token number">300</span><span class="token punctuation">,</span> mViewHeight <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">-</span> <span class="token number">300</span><span class="token punctuation">,</span> mViewWidth <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">+</span> <span class="token number">300</span><span class="token punctuation">,</span> mViewHeight <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">+</span> <span class="token number">300</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>YELLOW<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment" spellcheck="true">/* 
     * 保存并裁剪画布填充绿色 
     */</span>  
    <span class="token keyword">int</span> saveID2 <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>Canvas<span class="token punctuation">.</span>CLIP_SAVE_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    canvas<span class="token punctuation">.</span><span class="token function">clipRect</span><span class="token punctuation">(</span>mViewWidth <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">-</span> <span class="token number">200</span><span class="token punctuation">,</span> mViewHeight <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">-</span> <span class="token number">200</span><span class="token punctuation">,</span> mViewWidth <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">,</span> mViewHeight <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">+</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>GREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token comment" spellcheck="true">/* 
     * 保存画布并旋转后绘制一个蓝色的矩形 
     */</span>  
    <span class="token keyword">int</span> saveID3 <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>Canvas<span class="token punctuation">.</span>MATRIX_SAVE_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    canvas<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
    mPaint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>BLUE<span class="token punctuation">)</span><span class="token punctuation">;</span>  
    canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>mViewWidth <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">,</span> mViewHeight <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">-</span> <span class="token number">100</span><span class="token punctuation">,</span> mViewWidth <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">,</span> mViewHeight <span class="token operator">/</span> <span class="token number">2F</span> <span class="token operator">+</span> <span class="token number">100</span><span class="token punctuation">,</span> mPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>以上的代码产生<br><img src="http://upload-images.jianshu.io/upload_images/1321512-d7c318273bf16c36.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Canvas内部Stack"></p>
<ol>
<li>没有restore前saveID3,saveID2,saveID1,Default Stack ID相互影响。</li>
<li>restoreToCount(int saveCount) 还原特定Stack空间。</li>
<li>getSaveCount() 查询当前栈中有多少save的空间</li>
</ol>
<h2 id="第2节-Paint"><a href="#第2节-Paint" class="headerlink" title="第2节 Paint"></a>第2节 Paint</h2><h3 id="初始化类"><a href="#初始化类" class="headerlink" title="初始化类"></a>初始化类</h3><ul>
<li><h3 id="reset-相当于重新-new-一个，不过性能当然高一些啦"><a href="#reset-相当于重新-new-一个，不过性能当然高一些啦" class="headerlink" title="reset() 相当于重新 new 一个，不过性能当然高一些啦"></a>reset() 相当于重新 <code>new</code> 一个，不过性能当然高一些啦</h3></li>
<li><h3 id="set-Paint-src-属性全部复制过来"><a href="#set-Paint-src-属性全部复制过来" class="headerlink" title="set(Paint src) 属性全部复制过来"></a>set(Paint src) 属性全部复制过来</h3></li>
<li><h3 id="setFlags-int-flags"><a href="#setFlags-int-flags" class="headerlink" title="setFlags(int flags)"></a>setFlags(int flags)</h3><pre class="line-numbers language-java"><code class="language-java">paint<span class="token punctuation">.</span><span class="token function">setFlags</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>ANTI_ALIAS_FLAG <span class="token operator">|</span> Paint<span class="token punctuation">.</span>DITHER_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">//等价于</span>
paint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
paint<span class="token punctuation">.</span><span class="token function">setDither</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h3 id="笔头属性"><a href="#笔头属性" class="headerlink" title="笔头属性"></a>笔头属性</h3><ol>
<li><h5 id="Paint-setStyle-Paint-Style-style"><a href="#Paint-setStyle-Paint-Style-style" class="headerlink" title="Paint.setStyle(Paint.Style style)"></a>Paint.setStyle(Paint.Style style)</h5><ol>
<li><code>FILL</code> 是填充模式 （默认）</li>
<li><code>STROKE</code> 是画线模式（即勾边模式）</li>
<li><code>FILL_AND_STROKE</code> 是两种模式一并使用</li>
</ol>
</li>
<li><h5 id="Paint-setStrokeWidth-float-width-非填充模式下下，设置笔头（线条）粗细"><a href="#Paint-setStrokeWidth-float-width-非填充模式下下，设置笔头（线条）粗细" class="headerlink" title="Paint.setStrokeWidth(float width) 非填充模式下下，设置笔头（线条）粗细"></a>Paint.setStrokeWidth(float width) 非填充模式下下，设置笔头（线条）粗细</h5></li>
<li><p>setDither(boolean dither);   设定是否使用图像抖动处理，会使绘制出来的图片颜色更加平滑和饱满，图像更加清晰 </p>
</li>
<li><h5 id="抗锯齿"><a href="#抗锯齿" class="headerlink" title="抗锯齿"></a>抗锯齿</h5><pre class="line-numbers language-java"><code class="language-java">Paint paint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>ANTI_ALIAS_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token comment" spellcheck="true">//或</span>
Paint<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> aa<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>原理：修改图形边缘处的像素颜色，从而<strong>让图形在肉眼看来具有更加平滑的感觉</strong></p>
<p><img src="http://cdn.linz.tech/ANTI_ALIAS_FLAG.jpg" alt></p>
</li>
</ol>
<h3 id="笔锋属性及线条"><a href="#笔锋属性及线条" class="headerlink" title="笔锋属性及线条"></a>笔锋属性及线条</h3><pre class="line-numbers language-java"><code class="language-java">mPaint<span class="token punctuation">.</span><span class="token function">setStrokeCap</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Cap<span class="token punctuation">.</span>ROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>
mPaint<span class="token punctuation">.</span><span class="token function">setStrokeJoin</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Join<span class="token punctuation">.</span>BEVEL<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="http://cdn.linz.tech/android_cap_join_2019-09-14_15-13-37.png" alt></p>
<h4 id="PathEffect"><a href="#PathEffect" class="headerlink" title="PathEffect"></a>PathEffect</h4><p>setPathEffect(PathEffect effect)</p>
<p><a href="https://hencoder.com/ui-1-2/" target="_blank" rel="noopener">https://hencoder.com/ui-1-2/</a></p>
<blockquote>
<p>使用 <code>PathEffect</code> 来给图形的轮廓设置效果。对 <code>Canvas</code> 所有的图形绘制有效，也就是 <code>drawLine()</code> <code>drawCircle()</code> <code>drawPath()</code> 这些方法。</p>
</blockquote>
<ul>
<li><h4 id="CornerPathEffect-拐角变成圆角-可以将路径的转角变得圆滑"><a href="#CornerPathEffect-拐角变成圆角-可以将路径的转角变得圆滑" class="headerlink" title="CornerPathEffect 拐角变成圆角 可以将路径的转角变得圆滑"></a>CornerPathEffect 拐角变成圆角 可以将路径的转角变得圆滑</h4></li>
<li><h4 id="DiscretePathEffect-把线条进行随机的偏离"><a href="#DiscretePathEffect-把线条进行随机的偏离" class="headerlink" title="DiscretePathEffect 把线条进行随机的偏离"></a>DiscretePathEffect 把线条进行随机的偏离</h4></li>
<li><h4 id="DashPathEffect-虚线来绘制线条"><a href="#DashPathEffect-虚线来绘制线条" class="headerlink" title="DashPathEffect 虚线来绘制线条"></a>DashPathEffect 虚线来绘制线条</h4></li>
<li><h4 id="PathDashPathEffect-用一个-Path-来绘制「虚线」"><a href="#PathDashPathEffect-用一个-Path-来绘制「虚线」" class="headerlink" title="PathDashPathEffect 用一个 Path 来绘制「虚线」"></a>PathDashPathEffect 用一个 <code>Path</code> 来绘制「虚线」</h4></li>
<li><h4 id="SumPathEffect-分别单独绘制"><a href="#SumPathEffect-分别单独绘制" class="headerlink" title="SumPathEffect 分别单独绘制"></a>SumPathEffect 分别单独绘制</h4></li>
<li><h4 id="ComposePathEffect-叠加绘制"><a href="#ComposePathEffect-叠加绘制" class="headerlink" title="ComposePathEffect 叠加绘制"></a>ComposePathEffect 叠加绘制</h4></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1321512-a81268e6753051a6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="PathEffect六个子类"><br>对应的效果<br><img src="http://upload-images.jianshu.io/upload_images/1321512-ca3f53229a8b133d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<h4 id="StrokeMiter"><a href="#StrokeMiter" class="headerlink" title="StrokeMiter"></a>StrokeMiter</h4><blockquote>
<p>setStrokeMiter(float miter) 是对setStrokeJoin 的补充</p>
</blockquote>
<ol>
<li>作用</li>
</ol>
<p><img src="http://cdn.linz.tech/android_blog_paint_Miter.jpg" alt></p>
<ol start="2">
<li>怎么计算miter合理的值<br><img src="http://cdn.linz.tech/android_blog_paint_Miter_value.jpg" alt></li>
</ol>
<p>知道角度<code>1 / sin ( θ / 2 )</code></p>
<h3 id="文本绘制属性"><a href="#文本绘制属性" class="headerlink" title="文本绘制属性"></a>文本绘制属性</h3><pre class="line-numbers language-java"><code class="language-java">paint<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
mPaint<span class="token punctuation">.</span><span class="token function">setTextAlign</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Align<span class="token punctuation">.</span>CENTER<span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ol>
<li>setTypeface(Typeface typeface) 字体样式</li>
<li>setUnderlineText(boolean underlineText) 下划线</li>
<li>setStrikeThruText(boolean strikeThruText) 删除线</li>
<li>setFakeBoldText(boolean fakeBoldText) 粗体</li>
<li>setTextScaleX(float scaleX) 缩放因子，默认值为1</li>
<li>setTextSkewX(float skewX) 文本在水平方向上的倾斜，默认值为0，推荐的值为-0.25</li>
<li>setLetterSpacing(float letterSpacing) 设置行的间距，默认值是0，负值行间距会收缩</li>
<li>getFontSpacing() 返回字符行间距</li>
<li>measureForwards 向前还是向后/ maxWidth给定最大距离能测几个字符<br>应用场景：文本阅读器的翻页效果，我们需要在翻页的时候动态折断或生成一行字符串</li>
</ol>
<h4 id="FontMetrics"><a href="#FontMetrics" class="headerlink" title="FontMetrics"></a>FontMetrics</h4><p>mFontMetrics = mPaint.getFontMetrics();<br><img src="http://upload-images.jianshu.io/upload_images/1321512-a310e93aeb2e116e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="http://upload-images.jianshu.io/upload_images/1321512-4bfa331febf3c829.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1321512-cdfbd2bc9b21ffbc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>【注】：字符上方或者下方有可能有特殊字符，op的意思其实就是除了Baseline到字符顶端的距离外还应该包含这些符号的高度，bottom的意思也是一样。 通常情况下很少用到，所以忽略，但是Android依然会在绘制文本的时候在文本外层留出一定的边距，这就是为什么top和bottom总会比ascent和descent大一点的原因。</p>
<ul>
<li>ascent()/descent()</li>
</ul>
<h3 id="笔头着色属性"><a href="#笔头着色属性" class="headerlink" title="笔头着色属性"></a>笔头着色属性</h3><pre class="line-numbers language-java"><code class="language-java">paint<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#009688"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
paint<span class="token punctuation">.</span><span class="token function">setARGB</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>setDither(boolean dither) <ol>
<li>用在纯色的绘制</li>
<li>避免出现大片的色带与色块</li>
</ol>
</li>
<li>setShadowLayer(float radius, float dx, float dy, int shadowColor)<ul>
<li><code>radius</code> 是阴影的模糊范围； <code>dx</code> <code>dy</code> 是阴影的偏移量</li>
<li>清除阴影层，使用 <code>clearShadowLayer()</code></li>
<li>在硬件加速开启的情况下， <code>setShadowLayer()</code> 只支持文字的绘制，文字之外的绘制必须关闭硬件加速才能正常绘制阴影</li>
<li>阴影的透明度就使用 <code>paint</code> 的透明度</li>
</ul>
</li>
</ul>
<h4 id="setShader-Shader-shader"><a href="#setShader-Shader-shader" class="headerlink" title="setShader(Shader shader)"></a>setShader(Shader shader)</h4><ol>
<li><h5 id="BitmapShader-用-Bitmap-的像素来作为图形或文字的填充"><a href="#BitmapShader-用-Bitmap-的像素来作为图形或文字的填充" class="headerlink" title="BitmapShader 用 Bitmap 的像素来作为图形或文字的填充"></a>BitmapShader 用 <code>Bitmap</code> 的像素来作为图形或文字的填充</h5></li>
<li><h5 id="LinearGradient-线性渐变"><a href="#LinearGradient-线性渐变" class="headerlink" title="LinearGradient 线性渐变"></a>LinearGradient 线性渐变</h5></li>
<li><h5 id="RadialGradient-辐射渐变"><a href="#RadialGradient-辐射渐变" class="headerlink" title="RadialGradient 辐射渐变"></a>RadialGradient 辐射渐变</h5></li>
<li><h5 id="SweepGradient-扫描渐变"><a href="#SweepGradient-扫描渐变" class="headerlink" title="SweepGradient 扫描渐变"></a>SweepGradient 扫描渐变</h5></li>
<li><p>ComposeShader 混合着色器 两个 <code>Shader</code> 一起使用</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 第一个 Shader：头像的 Bitmap</span>
Bitmap bitmap1 <span class="token operator">=</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>batman<span class="token punctuation">)</span><span class="token punctuation">;</span>  
Shader shader1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapShader</span><span class="token punctuation">(</span>bitmap1<span class="token punctuation">,</span> Shader<span class="token punctuation">.</span>TileMode<span class="token punctuation">.</span>CLAMP<span class="token punctuation">,</span> Shader<span class="token punctuation">.</span>TileMode<span class="token punctuation">.</span>CLAMP<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// 第二个 Shader：从上到下的线性渐变（由透明到黑色）</span>
Bitmap bitmap2 <span class="token operator">=</span> BitmapFactory<span class="token punctuation">.</span><span class="token function">decodeResource</span><span class="token punctuation">(</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>batman_logo<span class="token punctuation">)</span><span class="token punctuation">;</span>  
Shader shader2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BitmapShader</span><span class="token punctuation">(</span>bitmap2<span class="token punctuation">,</span> Shader<span class="token punctuation">.</span>TileMode<span class="token punctuation">.</span>CLAMP<span class="token punctuation">,</span> Shader<span class="token punctuation">.</span>TileMode<span class="token punctuation">.</span>CLAMP<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ComposeShader：结合两个 Shader</span>
Shader shader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComposeShader</span><span class="token punctuation">(</span>shader1<span class="token punctuation">,</span> shader2<span class="token punctuation">,</span> PorterDuff<span class="token punctuation">.</span>Mode<span class="token punctuation">.</span>SRC_OVER<span class="token punctuation">)</span><span class="token punctuation">;</span>  
paint<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span>shader<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>其中PorterDuff.Mode 有<br><img src="http://cdn.linz.tech/PorterDuff_2019-09-14_21-36-30.png" alt></p>
</li>
</ol>
<h4 id="setColorFilter-ColorFilter-colorFilter"><a href="#setColorFilter-ColorFilter-colorFilter" class="headerlink" title="setColorFilter(ColorFilter colorFilter)"></a>setColorFilter(ColorFilter colorFilter)</h4><ul>
<li><p>LightingColorFilter(int mul, int add) 模拟简单的光照效果, 算法</p>
<pre><code>R' = R * mul.R / 0xff + add.R  
G' = G * mul.G / 0xff + add.G  
B' = B * mul.B / 0xff + add.B  </code></pre></li>
<li><h4 id="PorterDuffColorFilter-int-color-PorterDuff-Mode-mode-使用一个指定的颜色和一种指定的-PorterDuff-Mode-来与绘制对象进行合成"><a href="#PorterDuffColorFilter-int-color-PorterDuff-Mode-mode-使用一个指定的颜色和一种指定的-PorterDuff-Mode-来与绘制对象进行合成" class="headerlink" title="PorterDuffColorFilter (int color, PorterDuff.Mode mode) 使用一个指定的颜色和一种指定的 PorterDuff.Mode 来与绘制对象进行合成"></a>PorterDuffColorFilter (int color, PorterDuff.Mode mode) 使用一个指定的颜色和一种指定的 <code>PorterDuff.Mode</code> 来与绘制对象进行合成</h4></li>
<li><h4 id="ColorMatrixColorFilter"><a href="#ColorMatrixColorFilter" class="headerlink" title="ColorMatrixColorFilter"></a>ColorMatrixColorFilter</h4><p>参考附录一<a href="https://github.com/chengdazhi/StyleImageView" target="_blank" rel="noopener">StyleImageView</a> </p>
</li>
</ul>
<h3 id="合成-Xfermode"><a href="#合成-Xfermode" class="headerlink" title="合成 Xfermode"></a>合成 Xfermode</h3><blockquote>
<p>使用 <code>setXfermode()</code> 正常绘制，必须使用离屏缓存 (Off-screen Buffer) 把内容绘制在额外的层上，再把绘制好的内容贴回 View 中</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 可以做短时的离屏缓冲</span>
<span class="token keyword">int</span> saved <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">saveLayer</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> null<span class="token punctuation">,</span> Canvas<span class="token punctuation">.</span>ALL_SAVE_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>
Xfermode xfermode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PorterDuffXfermode</span><span class="token punctuation">(</span>PorterDuff<span class="token punctuation">.</span>Mode<span class="token punctuation">.</span>DST_IN<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>rectBitmap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 画方  </span>
paint<span class="token punctuation">.</span><span class="token function">setXfermode</span><span class="token punctuation">(</span>xfermode<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 设置 Xfermode  </span>
canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>circleBitmap<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 画圆  </span>
paint<span class="token punctuation">.</span><span class="token function">setXfermode</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 用完及时清除 Xfermode  </span>
canvas<span class="token punctuation">.</span><span class="token function">restoreToCount</span><span class="token punctuation">(</span>saved<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="setMaskFilter"><a href="#setMaskFilter" class="headerlink" title="setMaskFilter"></a>setMaskFilter</h4><p>基于整个画面来进行过滤</p>
<ol>
<li><h4 id="BlurMaskFilter"><a href="#BlurMaskFilter" class="headerlink" title="BlurMaskFilter"></a>BlurMaskFilter</h4><pre class="line-numbers language-java"><code class="language-java">paint<span class="token punctuation">.</span><span class="token function">setMaskFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BlurMaskFilter</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> BlurMaskFilter<span class="token punctuation">.</span>Blur<span class="token punctuation">.</span>NORMAL<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>另一种思维实现模糊</strong></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 获取位图的Alpha通道图  </span>
     shadowBitmap <span class="token operator">=</span> srcBitmap<span class="token punctuation">.</span><span class="token function">extractAlpha</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 先绘制阴影  </span>
     canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>shadowBitmap<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> shadowPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
     <span class="token comment" spellcheck="true">// 再绘制位图  </span>
     canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>srcBitmap<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><h4 id="EmbossMaskFilter-浮雕效果"><a href="#EmbossMaskFilter-浮雕效果" class="headerlink" title="EmbossMaskFilter 浮雕效果"></a>EmbossMaskFilter 浮雕效果</h4></li>
</ol>
<h2 id="第3节-Path"><a href="#第3节-Path" class="headerlink" title="第3节 Path"></a>第3节 Path</h2><ul>
<li>quadTo(float x1, float y1, float x2, float y2)<br><img src="http://upload-images.jianshu.io/upload_images/1321512-6cfc0b62238227a5.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="http://upload-images.jianshu.io/upload_images/1321512-ef369f4f26f04e5a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 实例化路径  </span>
mPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 移动点至[100,100]  </span>
mPath<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 连接路径到点  </span>
mPath<span class="token punctuation">.</span><span class="token function">quadTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>cubicTo(float x1, float y1, float x2, float y2, float x3, float y3)<br><img src="http://upload-images.jianshu.io/upload_images/1321512-046df21da3e17477.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 实例化路径  </span>
mPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 移动点至[100,100]  </span>
mPath<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 连接路径到点  </span>
mPath<span class="token punctuation">.</span><span class="token function">cubicTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>arcTo (RectF oval, float startAngle, float sweepAngle)<br><img src="http://upload-images.jianshu.io/upload_images/1321512-66679606910e82c8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 实例化路径  </span>
mPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 移动点至[100,100]  </span>
mPath<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 连接路径到点  </span>
RectF oval <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
mPath<span class="token punctuation">.</span><span class="token function">arcTo</span><span class="token punctuation">(</span>oval<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>arcTo (RectF oval, float startAngle, float sweepAngle, boolean forceMoveTo)<br><img src="http://upload-images.jianshu.io/upload_images/1321512-a37b819668c0aebb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="mPath.arcTo(oval, 0, 90, true); "></li>
<li>rXXXTo方法,坐标相对于当前点，而不是画布原点。<pre class="line-numbers language-java"><code class="language-java"><span class="token function">rCubicTo</span><span class="token punctuation">(</span><span class="token keyword">float</span> x1<span class="token punctuation">,</span> <span class="token keyword">float</span> y1<span class="token punctuation">,</span> <span class="token keyword">float</span> x2<span class="token punctuation">,</span> <span class="token keyword">float</span> y2<span class="token punctuation">,</span> <span class="token keyword">float</span> x3<span class="token punctuation">,</span> <span class="token keyword">float</span> y3<span class="token punctuation">)</span>  
<span class="token function">rLineTo</span><span class="token punctuation">(</span><span class="token keyword">float</span> dx<span class="token punctuation">,</span> <span class="token keyword">float</span> dy<span class="token punctuation">)</span>  
<span class="token function">rMoveTo</span><span class="token punctuation">(</span><span class="token keyword">float</span> dx<span class="token punctuation">,</span> <span class="token keyword">float</span> dy<span class="token punctuation">)</span>  
<span class="token function">rQuadTo</span><span class="token punctuation">(</span><span class="token keyword">float</span> dx1<span class="token punctuation">,</span> <span class="token keyword">float</span> dy1<span class="token punctuation">,</span> <span class="token keyword">float</span> dx2<span class="token punctuation">,</span> <span class="token keyword">float</span> dy2<span class="token punctuation">)</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li>addXXX方法<pre class="line-numbers language-java"><code class="language-java"><span class="token function">addCircle</span><span class="token punctuation">(</span><span class="token keyword">float</span> x<span class="token punctuation">,</span> <span class="token keyword">float</span> y<span class="token punctuation">,</span> <span class="token keyword">float</span> radius<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>Direction dir<span class="token punctuation">)</span>  
<span class="token function">addOval</span><span class="token punctuation">(</span><span class="token keyword">float</span> left<span class="token punctuation">,</span> <span class="token keyword">float</span> top<span class="token punctuation">,</span> <span class="token keyword">float</span> right<span class="token punctuation">,</span> <span class="token keyword">float</span> bottom<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>Direction dir<span class="token punctuation">)</span>  
<span class="token function">addRect</span><span class="token punctuation">(</span><span class="token keyword">float</span> left<span class="token punctuation">,</span> <span class="token keyword">float</span> top<span class="token punctuation">,</span> <span class="token keyword">float</span> right<span class="token punctuation">,</span> <span class="token keyword">float</span> bottom<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>Direction dir<span class="token punctuation">)</span>  
<span class="token function">addRoundRect</span><span class="token punctuation">(</span><span class="token keyword">float</span> left<span class="token punctuation">,</span> <span class="token keyword">float</span> top<span class="token punctuation">,</span> <span class="token keyword">float</span> right<span class="token punctuation">,</span> <span class="token keyword">float</span> bottom<span class="token punctuation">,</span> <span class="token keyword">float</span> rx<span class="token punctuation">,</span> <span class="token keyword">float</span> ry<span class="token punctuation">,</span> Path<span class="token punctuation">.</span>Direction dir<span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>addOval Sample 弧线并没与线段连接<pre class="line-numbers language-java"><code class="language-java">mPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 移动点至[100,100]  </span>
mPath<span class="token punctuation">.</span><span class="token function">moveTo</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 连接路径到点  </span>
mPath<span class="token punctuation">.</span><span class="token function">lineTo</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 添加一条弧线到Path中  </span>
RectF oval <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
mPath<span class="token punctuation">.</span><span class="token function">addArc</span><span class="token punctuation">(</span>oval<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">90</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="http://upload-images.jianshu.io/upload_images/1321512-d43de1a91d8aa955.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></li>
<li>Path.Direction.CCW<br><img src="http://upload-images.jianshu.io/upload_images/1321512-19a364da5ab1d0ed.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></li>
<li>Path.Direction.CW<br><img src="http://upload-images.jianshu.io/upload_images/1321512-aec59eb38640c0f4.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></li>
</ul>
</li>
<li>computeBounds() <pre class="line-numbers language-java"><code class="language-java">mComputeRect <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
mEndPath <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Path</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
mEndPath<span class="token punctuation">.</span><span class="token function">addCircle</span><span class="token punctuation">(</span><span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">380</span><span class="token punctuation">,</span> <span class="token number">150</span><span class="token punctuation">,</span> Direction<span class="token punctuation">.</span>CW<span class="token punctuation">)</span><span class="token punctuation">;</span>  
mEndPath<span class="token punctuation">.</span><span class="token function">addRect</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RectF</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> Direction<span class="token punctuation">.</span>CW<span class="token punctuation">)</span><span class="token punctuation">;</span>  
mEndPath<span class="token punctuation">.</span><span class="token function">computeBounds</span><span class="token punctuation">(</span>mComputeRect<span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//图片如下，返回结果为： （200,230,530,530）</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<img src="http://upload-images.jianshu.io/upload_images/1321512-4385d6a94519b1ba.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></li>
</ul>
<h2 id="第4节-Camera-【了解】"><a href="#第4节-Camera-【了解】" class="headerlink" title="第4节 Camera 【了解】"></a>第4节 Camera 【了解】</h2><p><a href="https://hencoder.com/ui-1-4/" target="_blank" rel="noopener">https://hencoder.com/ui-1-4/</a></p>
<blockquote>
<p><code>Camera</code> 的三维变换有三类：旋转、平移、移动相机</p>
</blockquote>
<h3 id="Camera-rotate-三维旋转"><a href="#Camera-rotate-三维旋转" class="headerlink" title="Camera.rotate*() 三维旋转"></a>Camera.rotate*() 三维旋转</h3><pre class="line-numbers language-java"><code class="language-java">canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

camera<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 保存 Camera 的状态  </span>
camera<span class="token punctuation">.</span><span class="token function">rotateX</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 旋转 Camera 的三维空间  </span>
camera<span class="token punctuation">.</span><span class="token function">applyToCanvas</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 把旋转投影到 Canvas  </span>
camera<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 恢复 Camera 的状态</span>

canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>bitmap<span class="token punctuation">,</span> point1<span class="token punctuation">.</span>x<span class="token punctuation">,</span> point1<span class="token punctuation">.</span>y<span class="token punctuation">,</span> paint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="Camera-translate-float-x-float-y-float-z-移动"><a href="#Camera-translate-float-x-float-y-float-z-移动" class="headerlink" title="Camera.translate(float x, float y, float z) 移动"></a>Camera.translate(float x, float y, float z) 移动</h3><h3 id="Camera-setLocation-x-y-z-设置虚拟相机的位置"><a href="#Camera-setLocation-x-y-z-设置虚拟相机的位置" class="headerlink" title="Camera.setLocation(x, y, z) 设置虚拟相机的位置"></a>Camera.setLocation(x, y, z) 设置虚拟相机的位置</h3><blockquote>
<p> 单位不是像素，而是 inch</p>
</blockquote>
<p>  在 <code>Camera</code> 中，相机的默认位置是 (0, 0, -8)（英寸）。8 x 72 = 576，所以它的默认位置是 (0, 0, -576)（像素）</p>
<h2 id="View绘制流程"><a href="#View绘制流程" class="headerlink" title="View绘制流程"></a>View绘制流程</h2><p><img src="http://cdn.linz.tech/android_ondraw_2019-09-14_15-13-37.png" alt></p>
<ol>
<li>在 <code>ViewGroup</code> 的子类中重写除 <code>dispatchDraw()</code> 以外的绘制方法时，可能需要调用 <code>setWillNotDraw(false)</code>；</li>
<li>在重写的方法有多个选择时，优先选择 <code>onDraw()</code></li>
</ol>
<h1 id="第二章-初学易犯错误"><a href="#第二章-初学易犯错误" class="headerlink" title="第二章 初学易犯错误"></a>第二章 初学易犯错误</h1><h2 id="构造方法缺失"><a href="#构造方法缺失" class="headerlink" title="构造方法缺失"></a>构造方法缺失</h2><blockquote>
<p>原因：把自定义View放在Xml布局文件加载，没有实现带属性的构造方法</p>
</blockquote>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SampleCustomView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token function">SampleCustomView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token annotation punctuation">@Override</span> <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>LTGRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>异常如下：</p>
<pre class="line-numbers language-xml"><code class="language-xml"> Caused by: java.lang.NoSuchMethodException: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>init</span><span class="token punctuation">></span></span> [class android.content.Context, interface android.util.AttributeSet]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>原因：布局在inflate SampleCustomView 的时候要把解析完成的属性专递给自定义View</p>
<h2 id="属性继承"><a href="#属性继承" class="headerlink" title="属性继承"></a>属性继承</h2><p>CustomView 代码</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomView</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{</span>   
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>attrs.xml</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CustomView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reference|color<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>background<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>系统异常提示：</p>
<pre class="line-numbers language-log"><code class="language-log">app\build\intermediates\incremental\mergeDebugResources\merged.dir\values\values.xml:2552: error: duplicate value for resource 'attr/background' with config ''.<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>如果是继承不是系统的View，异常</p>
<pre><code>src\main\res\values\attrs.xml: Error: Found item Attr/radius more than one time</code></pre><p>可以看出Android 在编译的时候会把View 和CustomView 的属性进行合并，也就是说<code>自定义属性具有继承性</code>, 即：</p>
<ol>
<li>自定义View的属性不能和父View同名；</li>
<li>子View继承父View的所有属性；</li>
</ol>
<h2 id="drawText-坐标错误"><a href="#drawText-坐标错误" class="headerlink" title="drawText 坐标错误"></a>drawText 坐标错误</h2><ul>
<li><h3 id="drawText-String-text-float-x-float-y-Paint-paint-（x-y）指如下："><a href="#drawText-String-text-float-x-float-y-Paint-paint-（x-y）指如下：" class="headerlink" title="drawText(String text, float x, float y, Paint paint) ,（x, y）指如下："></a>drawText(String text, float x, float y, Paint paint) ,（x, y）指如下：</h3></li>
</ul>
<p><img src="http://cdn.linz.tech/android_blog_drawText.jpg" alt></p>
<h2 id="不知道不会用硬件加速"><a href="#不知道不会用硬件加速" class="headerlink" title="不知道不会用硬件加速"></a>不知道不会用硬件加速</h2><h3 id="什么是硬件加速"><a href="#什么是硬件加速" class="headerlink" title="什么是硬件加速"></a>什么是硬件加速</h3><blockquote>
<h2 id="一句话：用GPU绘制View"><a href="#一句话：用GPU绘制View" class="headerlink" title="一句话：用GPU绘制View"></a>一句话：用GPU绘制View</h2><h3 id="理解：现在很多主流手机机型都会有GPU，甚至比一些电脑的配置都高。手机和电脑硬件架构基本类似，不开启和开启硬件加速，就像集显和有1G显卡的不同，程序员应该秒懂。"><a href="#理解：现在很多主流手机机型都会有GPU，甚至比一些电脑的配置都高。手机和电脑硬件架构基本类似，不开启和开启硬件加速，就像集显和有1G显卡的不同，程序员应该秒懂。" class="headerlink" title="理解：现在很多主流手机机型都会有GPU，甚至比一些电脑的配置都高。手机和电脑硬件架构基本类似，不开启和开启硬件加速，就像集显和有1G显卡的不同，程序员应该秒懂。"></a>理解：现在很多主流手机机型都会有GPU，甚至比一些电脑的配置都高。手机和电脑硬件架构基本类似，不开启和开启硬件加速，就像集显和有1G显卡的不同，程序员应该秒懂。</h3></blockquote>
<p>具体的优化效果是</p>
<ol>
<li>绘制块；</li>
<li>刷新频率提高；</li>
</ol>
<h3 id="怎么开启"><a href="#怎么开启" class="headerlink" title="怎么开启"></a>怎么开启</h3><p>ObjectAnimator</p>
<pre class="line-numbers language-java"><code class="language-java">view<span class="token punctuation">.</span><span class="token function">setLayerType</span><span class="token punctuation">(</span>LAYER_TYPE_HARDWARE<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>  
ObjectAnimator animator <span class="token operator">=</span> ObjectAnimator<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> <span class="token string">"rotationY"</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

animator<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnimatorListenerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationEnd</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        view<span class="token punctuation">.</span><span class="token function">setLayerType</span><span class="token punctuation">(</span>LAYER_TYPE_NONE<span class="token punctuation">,</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>ViewPropertyAnimator</p>
<pre class="line-numbers language-java"><code class="language-java">view<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">rotationY</span><span class="token punctuation">(</span><span class="token number">90</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">withLayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// withLayer() 可以自动完成上面这段代码的复杂操作</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="使用条件"><a href="#使用条件" class="headerlink" title="使用条件"></a>使用条件</h3><ol>
<li><p>受到 GPU 绘制方式的限制，<code>Canvas</code> 的有些方法在硬件加速开启式会失效或无法正常工作，如下图</p>
<p><img src="http://ws2.sinaimg.cn/large/006tKfTcly1fjn0huxdm5j30lr0q0n25.jpg" alt></p>
<blockquote>
<h2 id="Canvas-调用以上方法需要检测系统API"><a href="#Canvas-调用以上方法需要检测系统API" class="headerlink" title="Canvas` 调用以上方法需要检测系统API"></a>Canvas` 调用以上方法需要检测系统API</h2></blockquote>
</li>
<li><p>只有你在对 translationX translationY rotation alpha 等无需调用 invalidate() 的属性做动画的时候，这种方法才适用 ，故结论是 </p>
<blockquote>
<h2 id="这种方式不适用于基于自定义属性绘制的动画"><a href="#这种方式不适用于基于自定义属性绘制的动画" class="headerlink" title="　这种方式不适用于基于自定义属性绘制的动画"></a>　<strong>这种方式不适用于基于自定义属性绘制的动画</strong></h2></blockquote>
</li>
<li><p>View 在初次绘制时以及每次 <code>invalidate()</code> 后重绘时，需要进行两次的绘制工作（一次绘制到 Layer，一次从 Layer 绘制到显示屏），所以其实它的每次绘制的效率是被降低了的</p>
</li>
</ol>
<h1 id="第三章-怎么向自定义View传参"><a href="#第三章-怎么向自定义View传参" class="headerlink" title="第三章 怎么向自定义View传参"></a>第三章 怎么向自定义View传参</h1><blockquote>
<p> 通过Android自定义属性可以向自定义View传入特定参数</p>
</blockquote>
<h2 id="第1节-最简单案例"><a href="#第1节-最简单案例" class="headerlink" title="第1节 最简单案例"></a>第1节 最简单案例</h2><p>第一步：申明属性，一般存放在<code>value/attrs.xml</code>文件下</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CustomView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dimension<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radius<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意：申明属性的名称最好和自定义View名称一样， 如上面自定义属性，自定义View名称是<code>CustomView</code></p>
<p>第二步：在布局文件xml中使用自定义属性</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>android.support.constraint.ConstraintLayout</span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>app</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">xmlns:</span>iview</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res-auto<span class="token punctuation">"</span></span>
    <span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>com.iview.easyview.CustomView</span>
      <span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200dp<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">android:</span>layout_height</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200dp<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">android:</span>layout_marginStart</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>16dp<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">iview:</span>radius</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>30dp<span class="token punctuation">"</span></span>
      <span class="token attr-name"><span class="token namespace">app:</span>layout_constraintBottom_toBottomOf</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>parent<span class="token punctuation">"</span></span>
      <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>android.support.constraint.ConstraintLayout</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>解析： </p>
<ul>
<li><code>xmlns:app</code> ,<code>xmlns:iview</code> 虽然指向同一个命名空间（xmlns）<code>http://schemas.android.com/apk/res-auto</code>,但是用不同的名称，意图是让阅读者清楚区分不同的自定义属性归属。 <code>xmlns:app</code> 指向 <code>ConstraintLayout</code> ，<code>xmlns:iview</code> 指向<code>CustomView</code></li>
</ul>
<p>第三步：在自定义View中获取自定义属性，进行动态配置</p>
<pre class="line-numbers language-java"><code class="language-java">  <span class="token keyword">public</span> <span class="token function">CustomView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> AttributeSet attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    TypedArray ta <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span> R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>CustomView<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRadius <span class="token operator">=</span> ta<span class="token punctuation">.</span><span class="token function">getDimensionPixelSize</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>CustomView_radius<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ta<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="第2节-8种基本类型传参（format）"><a href="#第2节-8种基本类型传参（format）" class="headerlink" title="第2节 8种基本类型传参（format）"></a>第2节 8种基本类型传参（format）</h2><pre class="line-numbers language-xml"><code class="language-xml">&lt;declare-styleable name = "View">
     &lt;attr name = "background" format = "xxx" />
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>其中xxx可为如下：</p>
<ol>
<li><strong>reference：参考某一资源ID</strong></li>
<li><strong>color：颜色值</strong></li>
<li><strong>boolean：布尔值</strong></li>
<li><strong>dimension：尺寸值</strong></li>
<li><strong>float：浮点值</strong></li>
<li><strong>integer：整型值</strong></li>
<li><strong>string：字符串</strong></li>
<li><strong>fraction：百分数</strong> 如 “200%”</li>
</ol>
<h2 id="第3节-单选，多选混合传参"><a href="#第3节-单选，多选混合传参" class="headerlink" title="第3节 单选，多选混合传参"></a>第3节 单选，多选混合传参</h2><p>单选，<strong>enum：枚举值</strong></p>
<pre class="line-numbers language-xml"><code class="language-xml">   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dimension<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layout_height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fill_parent<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attr</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>多选，<strong>flag：位或运算</strong></p>
<pre class="line-numbers language-xml"><code class="language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>gravity<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x30<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bottom<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x50<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x03<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x05<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x10<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attr</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>混合，<strong>混合类型：</strong></p>
<pre class="line-numbers language-xml"><code class="language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reference|color<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>background<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>综合应该像这样</p>
<pre class="line-numbers language-xml"><code class="language-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CustomView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dimension<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>radius<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token comment" spellcheck="true">&lt;!--单选--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>dimension<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>layout_height<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>fill_parent<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>match_parent<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enum</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>wrap_content<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attr</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--多选--></span>
    <span class="token comment" spellcheck="true">&lt;!--android:gravity="bottom|left"/>--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>gravity2<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>top<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x30<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>bottom<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x50<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>left<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x03<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>right<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x05<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>flag</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>center_vertical<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0x10<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>attr</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--混合--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reference|color<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>background<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="第四章-控件默认Style从那来的？Theme原理"><a href="#第四章-控件默认Style从那来的？Theme原理" class="headerlink" title="第四章 控件默认Style从那来的？Theme原理"></a>第四章 控件默认Style从那来的？Theme原理</h1><p>相信很多初学者甚至一些做了几年Android的人对style，对theme都有一种超级复杂的感觉，不想触碰，遇到问题百度一下，解决就算了。但是作为前端UI style的架构逻辑不清楚，真的是一个致命伤的，相信我这个过来人说的话!</p>
<p>我原来也觉得太复杂了，但是研究<img src="http://cdn.linz.tech/0A7EBEC3.jpg" alt="img"> 真的很简单。</p>
<h2 id="Theme原理"><a href="#Theme原理" class="headerlink" title="Theme原理"></a>Theme原理</h2><p><img src="http://cdn.linz.tech/android_theme_base_ui.png" alt></p>
<p>如上图是从Android  studio 直接用拖出来的原生控件，学习了自定义属性后，自然会有如下疑问：</p>
<ol>
<li>上面的属性是那来的；</li>
<li>修改主题为什么对应的控件也会出现变化；</li>
</ol>
<p>参考TextView的源代码</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token function">TextView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> AttributeSet attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> com<span class="token punctuation">.</span>android<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>R<span class="token punctuation">.</span>attr<span class="token punctuation">.</span>textViewStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>白话翻译：当xml布局没有该属性时，读取属性<code>R.attr.textViewStyle</code>指定的属性。</p>
<p>是否这里一脸懵逼，听不懂，怎么用，抓狂呢？具体设置如下：</p>
<p>第一步：增加自定义属性，如下属性<code>StyleInTheme</code>属性；</p>
<p>attr.xml</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--自定义属性--></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>declare-styleable</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>CustomView<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mview_1<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mview_2<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>string<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mview_3<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>declare-styleable</span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!--定义CustomView默认的style--></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>attr</span> <span class="token attr-name">format</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>reference<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>StyleInTheme<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第二步：Theme中设置上面的属性指向一个Style：</p>
<pre class="line-numbers language-xml"><code class="language-xml">  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>AppTheme<span class="token punctuation">"</span></span> <span class="token attr-name">parent</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>Theme.AppCompat.Light.DarkActionBar<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token comment" spellcheck="true">&lt;!-- Customize your theme here. --></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>colorPrimary<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>colorPrimaryDark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorPrimaryDark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>colorAccent<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@color/colorAccent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
      <span class="token comment" spellcheck="true">&lt;!--自定style--></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>StyleInTheme<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>@style/StyleForTheme<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>item</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>StyleForTheme<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style language-css">
    &lt;item name=<span class="token string">"mview_1"</span>>declare in theme by style&lt;/item>
    &lt;item name=<span class="token string">"mview_2"</span>>declare in theme by style&lt;/item>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第三步：在自定义View中指定</p>
<pre class="line-numbers language-java"><code class="language-java">  <span class="token keyword">public</span> <span class="token function">CustomView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> AttributeSet attrs<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">//R.attr.StyleInTheme 必须和Theme中的属性对应</span>
    <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span>R<span class="token punctuation">.</span>attr<span class="token punctuation">.</span>StyleInTheme<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">public</span> <span class="token function">CustomView</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> AttributeSet attrs<span class="token punctuation">,</span> <span class="token keyword">int</span> defStyleAttr<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyleAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment" spellcheck="true">// 可以获取StyleForTheme中设置的属性</span>
    TypedArray a <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span> R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>CustomView<span class="token punctuation">,</span>defStyleAttr<span class="token punctuation">,</span>R<span class="token punctuation">.</span>style<span class="token punctuation">.</span>DefaultStyleRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
    mRadius <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getDimensionPixelSize</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>CustomView_mview_1<span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="设置属性的5等级"><a href="#设置属性的5等级" class="headerlink" title="设置属性的5等级"></a>设置属性的5等级</h2><blockquote>
<p> 明白可设置属性的5等级，style和theme都是浮云</p>
</blockquote>
<p>如上所有的属性解析都指向</p>
<pre class="line-numbers language-java"><code class="language-java">context<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>attrs<span class="token punctuation">,</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>CustomView<span class="token punctuation">,</span>defStyleAttr<span class="token punctuation">,</span>R<span class="token punctuation">.</span>style<span class="token punctuation">.</span>DefaultStyleRes<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>源码指向Resources#obtainStyledAttributes，如下重点注释</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
* 上面省略...
* &lt;ol>
*     &lt;li> Any attribute values in the given AttributeSet.
*     &lt;li> The style resource specified in the AttributeSet (named
*     "style").
*     &lt;li> The default style specified by &lt;var>defStyleAttr&lt;/var> and
*     &lt;var>defStyleRes&lt;/var>
*     &lt;li> The base values in this theme.
* &lt;/ol>
* ....
**/</span>
<span class="token keyword">public</span> TypedArray <span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>AttributeSet set<span class="token punctuation">,</span><span class="token keyword">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span> attrs<span class="token punctuation">,</span> <span class="token keyword">int</span> defStyleAttr<span class="token punctuation">,</span> <span class="token keyword">int</span> defStyleRes<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> mThemeImpl<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> set<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyleAttr<span class="token punctuation">,</span> defStyleRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注释意思是： 定义了一个获取属性的优先级，当两个以上级别同时存在时优先选择级别高的。</p>
<p>如图数字越小优先级越高：</p>
<p><img src="http://cdn.linz.tech/android_attr_level2019-09-14_10-23-21.png" alt="数字越小优先级越高"></p>
<p>根据<code>obtainStyledAttributes</code> 和上图理解Android style 和 Theme的架构体系，So Easy！！</p>
<h2 id="获取Style常用方法"><a href="#获取Style常用方法" class="headerlink" title="获取Style常用方法"></a>获取Style常用方法</h2><pre class="line-numbers language-java"><code class="language-java"> <span class="token keyword">final</span> TypedArray a <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">obtainStyledAttributes</span><span class="token punctuation">(</span>
                attrs<span class="token punctuation">,</span> R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>PopupWindow<span class="token punctuation">,</span> defStyleAttr<span class="token punctuation">,</span> defStyleRes<span class="token punctuation">)</span><span class="token punctuation">;</span>
ColorStateList backgroundColor <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getColorStateList</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>CardView_cardBackgroundColor<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span><span class="token function">hasValueOrEmpty</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>PopupWindow_popupAnimationStyle<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">final</span> <span class="token keyword">int</span> animStyle <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">getResourceId</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>styleable<span class="token punctuation">.</span>PopupWindow_popupAnimationStyle<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
a<span class="token punctuation">.</span><span class="token function">recycle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="第五章-View-动画（属性的修改）"><a href="#第五章-View-动画（属性的修改）" class="headerlink" title="第五章 View 动画（属性的修改）"></a>第五章 View 动画（属性的修改）</h1><blockquote>
<h2 id="View-动画的本质是一定时间段内动态的改变View的一个或多个属性，以达到动画的效果"><a href="#View-动画的本质是一定时间段内动态的改变View的一个或多个属性，以达到动画的效果" class="headerlink" title="View 动画的本质是一定时间段内动态的改变View的一个或多个属性，以达到动画的效果"></a>View 动画的本质是一定时间段内动态的改变View的一个或多个属性，以达到动画的效果</h2><h3 id="三个关键要素"><a href="#三个关键要素" class="headerlink" title="三个关键要素"></a>三个关键要素</h3><ol>
<li>起始时间</li>
<li>改变的属性</li>
<li>改变的方式</li>
</ol>
</blockquote>
<h2 id="第1节-改变属性"><a href="#第1节-改变属性" class="headerlink" title="第1节 改变属性"></a>第1节 改变属性</h2><h3 id="最小案例"><a href="#最小案例" class="headerlink" title="最小案例"></a>最小案例</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// imageView1: 500 毫秒</span>
imageView1<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">translationX</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ObjectAnimator animator <span class="token operator">=</span> 
    ObjectAnimator<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span>imageView<span class="token punctuation">,</span> <span class="token string">"translationX"</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token comment" spellcheck="true">/*改变属性的最终值*/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
animator<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>因此动画可改变的属性有</p>
<ol>
<li><p>继承于View的属性<br><img src="http://ws1.sinaimg.cn/large/006tKfTcgy1fj7x3rm1xxj30u50laq6y.jpg" alt></p>
</li>
<li><p>自定义View中的<code>自定义属性</code></p>
</li>
</ol>
<h2 id="第2节-改变方式"><a href="#第2节-改变方式" class="headerlink" title="第2节 改变方式"></a>第2节 改变方式</h2><h3 id="2-1-Interpolator"><a href="#2-1-Interpolator" class="headerlink" title="2.1 Interpolator"></a>2.1 Interpolator</h3><p><a href="https://hencoder.com/ui-1-6/" target="_blank" rel="noopener">https://hencoder.com/ui-1-6/</a></p>
<p><a href="https://github.com/MasayukiSuda/EasingInterpolator" target="_blank" rel="noopener"><strong>EasingInterpolator</strong></a></p>
<p><img src="https://raw.githubusercontent.com/MasayukiSuda/EasingInterpolator/master/art/easing.png" alt></p>
<h3 id="2-2-自定义-Evaluator"><a href="#2-2-自定义-Evaluator" class="headerlink" title="2.2 自定义 Evaluator"></a>2.2 自定义 Evaluator</h3><blockquote>
<h2 id="给起始值和进行的百分比，想要什么值自己定算法"><a href="#给起始值和进行的百分比，想要什么值自己定算法" class="headerlink" title="给起始值和进行的百分比，想要什么值自己定算法"></a>给起始值和进行的百分比，想要什么值自己定算法</h2></blockquote>
<p>案例一：颜色渐变Demo</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 自定义 HslEvaluator h 色度，s饱和度 l亮度</span>
<span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">HsvEvaluator</span> <span class="token keyword">implements</span> <span class="token class-name">TypeEvaluator</span><span class="token operator">&lt;</span>Integer<span class="token operator">></span> <span class="token punctuation">{</span>  
   <span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> startHsv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">float</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> endHsv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">float</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> outHsv <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">float</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> Integer <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token keyword">float</span> fraction<span class="token punctuation">,</span> Integer startValue<span class="token punctuation">,</span> Integer endValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true">// 把 ARGB 转换成 HSV</span>
       Color<span class="token punctuation">.</span><span class="token function">colorToHSV</span><span class="token punctuation">(</span>startValue<span class="token punctuation">,</span> startHsv<span class="token punctuation">)</span><span class="token punctuation">;</span>
       Color<span class="token punctuation">.</span><span class="token function">colorToHSV</span><span class="token punctuation">(</span>endValue<span class="token punctuation">,</span> endHsv<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment" spellcheck="true">// 计算当前动画完成度（fraction）所对应的颜色值</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>endHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> startHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">180</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           endHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">360</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>endHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> startHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token operator">-</span><span class="token number">180</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           endHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">360</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       outHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> startHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> startHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> fraction<span class="token punctuation">;</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>outHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           outHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">360</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>outHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
           outHsv<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+=</span> <span class="token number">360</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span>
       outHsv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> startHsv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endHsv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">-</span> startHsv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> fraction<span class="token punctuation">;</span>
       outHsv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> startHsv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token punctuation">(</span>endHsv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> startHsv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> fraction<span class="token punctuation">;</span>

       <span class="token comment" spellcheck="true">// 计算当前动画完成度（fraction）所对应的透明度</span>
       <span class="token keyword">int</span> alpha <span class="token operator">=</span> startValue <span class="token operator">>></span> <span class="token number">24</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>endValue <span class="token operator">>></span> <span class="token number">24</span> <span class="token operator">-</span> startValue <span class="token operator">>></span> <span class="token number">24</span><span class="token punctuation">)</span> <span class="token operator">*</span> fraction<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment" spellcheck="true">// 把 HSV 转换回 ARGB 返回</span>
       <span class="token keyword">return</span> Color<span class="token punctuation">.</span><span class="token function">HSVToColor</span><span class="token punctuation">(</span>alpha<span class="token punctuation">,</span> outHsv<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ObjectAnimator animator <span class="token operator">=</span> ObjectAnimator<span class="token punctuation">.</span><span class="token function">ofInt</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> <span class="token string">"color"</span><span class="token punctuation">,</span> <span class="token number">0xff00ff00</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 使用自定义的 HslEvaluator</span>
animator<span class="token punctuation">.</span><span class="token function">setEvaluator</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">HsvEvaluator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>案例二：使用Point（坐标）进行物体线路改变</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">PointFEvaluator</span> <span class="token keyword">implements</span> <span class="token class-name">TypeEvaluator</span><span class="token operator">&lt;</span>PointF<span class="token operator">></span> <span class="token punctuation">{</span>  
   PointF newPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> PointF <span class="token function">evaluate</span><span class="token punctuation">(</span><span class="token keyword">float</span> fraction<span class="token punctuation">,</span> PointF startValue<span class="token punctuation">,</span> PointF endValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">float</span> x <span class="token operator">=</span> startValue<span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token punctuation">(</span>fraction <span class="token operator">*</span> <span class="token punctuation">(</span>endValue<span class="token punctuation">.</span>x <span class="token operator">-</span> startValue<span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">float</span> y <span class="token operator">=</span> startValue<span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token punctuation">(</span>fraction <span class="token operator">*</span> <span class="token punctuation">(</span>endValue<span class="token punctuation">.</span>y <span class="token operator">-</span> startValue<span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       newPoint<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> newPoint<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

ObjectAnimator animator <span class="token operator">=</span> ObjectAnimator<span class="token punctuation">.</span><span class="token function">ofObject</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> <span class="token string">"position"</span><span class="token punctuation">,</span>  
        <span class="token keyword">new</span> <span class="token class-name">PointFEvaluator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">PointF</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-3-一次改变多个属性"><a href="#2-3-一次改变多个属性" class="headerlink" title="2.3 一次改变多个属性"></a>2.3 一次改变多个属性</h3><p>三种方式</p>
<ol>
<li>原生方式</li>
</ol>
<pre class="line-numbers language-java"><code class="language-java">view<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  
        <span class="token punctuation">.</span><span class="token function">scaleX</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">scaleY</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">alpha</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ol start="2">
<li><p>PropertyValuesHolder 方式</p>
<pre class="line-numbers language-java"><code class="language-java">PropertyValuesHolder holder1 <span class="token operator">=</span> PropertyValuesHolder<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token string">"scaleX"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
PropertyValuesHolder holder2 <span class="token operator">=</span> PropertyValuesHolder<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token string">"scaleY"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
PropertyValuesHolder holder3 <span class="token operator">=</span> PropertyValuesHolder<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token string">"alpha"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ObjectAnimator animator <span class="token operator">=</span> ObjectAnimator<span class="token punctuation">.</span><span class="token function">ofPropertyValuesHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> holder1<span class="token punctuation">,</span> holder2<span class="token punctuation">,</span> holder3<span class="token punctuation">)</span>  
animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>animatorSet方式</p>
<pre class="line-numbers language-java"><code class="language-java">animatorSet<span class="token punctuation">.</span><span class="token function">playTogether</span><span class="token punctuation">(</span>animator1<span class="token punctuation">,</span> animator2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
animatorSet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
</li>
</ol>
<h3 id="2-4-多属性改变设置顺序"><a href="#2-4-多属性改变设置顺序" class="headerlink" title="2.4 多属性改变设置顺序"></a>2.4 多属性改变设置顺序</h3><pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 使用 AnimatorSet.play(animatorA).with/before/after(animatorB)</span>
<span class="token comment" spellcheck="true">// 的方式来精确配置各个 Animator 之间的关系</span>
animatorSet<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>animator1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">with</span><span class="token punctuation">(</span>animator2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
animatorSet<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>animator1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>animator2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
animatorSet<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span>animator1<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>animator2<span class="token punctuation">)</span><span class="token punctuation">;</span>  
animatorSet<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="2-5-同一个属性关键帧拆分"><a href="#2-5-同一个属性关键帧拆分" class="headerlink" title="2.5 同一个属性关键帧拆分"></a>2.5 同一个属性关键帧拆分</h3><pre class="line-numbers language-java"><code class="language-java"> <span class="token comment" spellcheck="true">// 在 0% 处开始</span>
Keyframe keyframe1 <span class="token operator">=</span> Keyframe<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 时间经过 50% 的时候，动画完成度 100%</span>
Keyframe keyframe2 <span class="token operator">=</span> Keyframe<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token number">0.5f</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 时间见过 100% 的时候，动画完成度倒退到 80%，即反弹 20%</span>
Keyframe keyframe3 <span class="token operator">=</span> Keyframe<span class="token punctuation">.</span><span class="token function">ofFloat</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
PropertyValuesHolder holder <span class="token operator">=</span> PropertyValuesHolder<span class="token punctuation">.</span><span class="token function">ofKeyframe</span><span class="token punctuation">(</span><span class="token string">"progress"</span><span class="token punctuation">,</span> keyframe1<span class="token punctuation">,</span> keyframe2<span class="token punctuation">,</span> keyframe3<span class="token punctuation">)</span><span class="token punctuation">;</span>

ObjectAnimator animator <span class="token operator">=</span> ObjectAnimator<span class="token punctuation">.</span><span class="token function">ofPropertyValuesHolder</span><span class="token punctuation">(</span>view<span class="token punctuation">,</span> holder<span class="token punctuation">)</span><span class="token punctuation">;</span>
animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注解：代码逻辑是根据关键帧（Keyframe），指定Value；定义三个个点（Keyframe, value）</p>
<ol>
<li>（0,0）</li>
<li>（0.5,100）</li>
<li>（1,80）</li>
</ol>
<h2 id="第3节-监听改变"><a href="#第3节-监听改变" class="headerlink" title="第3节 监听改变"></a>第3节 监听改变</h2><p>AnimatorListenerAdapter.java</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AnimatorListenerAdapter</span> <span class="token keyword">implements</span> <span class="token class-name">Animator<span class="token punctuation">.</span>AnimatorListener</span><span class="token punctuation">,</span>
        Animator<span class="token punctuation">.</span>AnimatorPauseListener <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationCancel</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//onAnimationEnd()也会调用，后于Cancel</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationEnd</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationRepeat</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//由于 ViewPropertyAnimator 不支持重复，所以这个方法对 ViewPropertyAnimator 相当于无效</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationStart</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationPause</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationResume</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="第4节-实战笔记"><a href="#第4节-实战笔记" class="headerlink" title="第4节 实战笔记"></a>第4节 实战笔记</h2><h3 id="4-1-Tween-Animation"><a href="#4-1-Tween-Animation" class="headerlink" title="4.1 Tween Animation"></a>4.1 Tween Animation</h3><p>第一步： <code>res/anim/hyperspace_jump.xml</code> 动画修改逻辑xml配置</p>
<pre class="line-numbers language-xml"><code class="language-xml">&lt;set xmlns:android="http://schemas.android.com/apk/res/android"
    android:interpolator="@[package:]anim/interpolator_resource"
    android:shareInterpolator=["true" | "false"] >
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>alpha</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromAlpha</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toAlpha</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scale</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromXScale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toXScale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromYScale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toYScale</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pivotX</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pivotY</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>translate</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromXDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toXDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromYDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toYDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>rotate</span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromDegrees</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toDegrees</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pivotX</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>pivotY</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>float<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span><span class="token punctuation">></span></span>
        ...
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第二步：启动xml动画设置</p>
<pre class="line-numbers language-java"><code class="language-java">ImageView image <span class="token operator">=</span> <span class="token punctuation">(</span>ImageView<span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
Animation hyperspaceJump <span class="token operator">=</span> AnimationUtils<span class="token punctuation">.</span><span class="token function">loadAnimation</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> R<span class="token punctuation">.</span>anim<span class="token punctuation">.</span>hyperspace_jump<span class="token punctuation">)</span><span class="token punctuation">;</span>
image<span class="token punctuation">.</span><span class="token function">startAnimation</span><span class="token punctuation">(</span>hyperspaceJump<span class="token punctuation">)</span><span class="token punctuation">;</span>

AnimatorSet set <span class="token operator">=</span> <span class="token punctuation">(</span>AnimatorSet<span class="token punctuation">)</span> AnimatorInflater<span class="token punctuation">.</span><span class="token function">loadAnimator</span><span class="token punctuation">(</span>myContext<span class="token punctuation">,</span>
    R<span class="token punctuation">.</span>animator<span class="token punctuation">.</span>property_animator<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">setTarget</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>
set<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第三步：停止</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stopAnimation</span><span class="token punctuation">(</span>View v<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    v<span class="token punctuation">.</span><span class="token function">clearAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">canCancelAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       v<span class="token punctuation">.</span><span class="token function">animate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    
    <span class="token punctuation">}</span>    
    animation<span class="token punctuation">.</span><span class="token function">setAnimationListener</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>    
    v<span class="token punctuation">.</span><span class="token function">setAnimation</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">/**
 * Returns true if the API level supports canceling existing animations via the 
 * ViewPropertyAnimator, and false if it does not 
 * @return true if the API level supports canceling existing animations via the 
 * ViewPropertyAnimator, and false if it does not 
 */</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">canCancelAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Build<span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT <span class="token operator">>=</span> Build<span class="token punctuation">.</span>VERSION_CODES<span class="token punctuation">.</span>ICE_CREAM_SANDWICH<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>// 设置切换动画，从右边进入，左边退出<br>on Activity<br>overridePendingTransition(R.anim.in_from_right, R.anim.out_to_left);</p>
<pre class="line-numbers language-xml"><code class="language-xml">//in_from_right.xml
<span class="token prolog">&lt;?xml version="1.0" encoding="utf-8"?></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>interpolator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:anim/accelerate_interpolator<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>translate</span>
        <span class="token attr-name"><span class="token namespace">android:</span>duration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromXDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>100%p<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toXDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0%p<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span>

//out_to_left.xml
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>set</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>interpolator</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@android:anim/accelerate_interpolator<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>translate</span>
        <span class="token attr-name"><span class="token namespace">android:</span>duration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>20<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>fromXDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>0%p<span class="token punctuation">"</span></span>
        <span class="token attr-name"><span class="token namespace">android:</span>toXDelta</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>-100%p<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>set</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-2-Frame-Animation"><a href="#4-2-Frame-Animation" class="headerlink" title="4.2 Frame Animation"></a>4.2 Frame Animation</h3><p>第一步：定义xml文件， 位置<code>res/drawable/rocket_thrust.xml</code>如：</p>
<pre class="line-numbers language-xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>animation-list</span> <span class="token attr-name"><span class="token namespace">xmlns:</span>android</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://schemas.android.com/apk/res/android<span class="token punctuation">"</span></span>
    <span class="token attr-name"><span class="token namespace">android:</span>oneshot</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/thrust1<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>duration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/thrust2<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>duration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>item</span> <span class="token attr-name"><span class="token namespace">android:</span>drawable</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>@drawable/thrust3<span class="token punctuation">"</span></span> <span class="token attr-name"><span class="token namespace">android:</span>duration</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>200<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>animation-list</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>第二步： 使用</p>
<pre class="line-numbers language-java"><code class="language-java">ImageView rocketImage <span class="token operator">=</span> <span class="token punctuation">(</span>ImageView<span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>rocket_image<span class="token punctuation">)</span><span class="token punctuation">;</span>
rocketImage<span class="token punctuation">.</span><span class="token function">setBackgroundResource</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>drawable<span class="token punctuation">.</span>rocket_thrust<span class="token punctuation">)</span><span class="token punctuation">;</span>
rocketAnimation <span class="token operator">=</span> <span class="token punctuation">(</span>AnimationDrawable<span class="token punctuation">)</span> rocketImage<span class="token punctuation">.</span><span class="token function">getBackground</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rocketImage<span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">View<span class="token punctuation">.</span>OnClickListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onClick</span><span class="token punctuation">(</span>View view<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        rocketAnimation<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4-3-Spring-Animation"><a href="#4-3-Spring-Animation" class="headerlink" title="4.3 Spring Animation"></a>4.3 Spring Animation</h3><ul>
<li><a href="https://developer.android.google.cn/guide/topics/graphics/spring-animation" target="_blank" rel="noopener">Animate movement using spring physics</a></li>
<li><a href="https://www.jianshu.com/p/c2962a8135f5" target="_blank" rel="noopener">Android中弹簧动画的那些事 - SpringAnimation</a></li>
</ul>
<h4 id="CustomView案例笔记"><a href="#CustomView案例笔记" class="headerlink" title="CustomView案例笔记"></a>CustomView案例笔记</h4><ul>
<li><a href="http://blog.csdn.net/tianjian4592/article/details/44538605" target="_blank" rel="noopener">一个绚丽的loading动效分析与实现！</a></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1321512-6a6533d24b09bf74.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">//知道对应的边,求角度</span>
<span class="token keyword">int</span> angle <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> Math<span class="token punctuation">.</span><span class="token function">toDegrees</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">acos</span><span class="token punctuation">(</span><span class="token punctuation">(</span>mArcRadius <span class="token operator">-</span> mCurrentProgressPosition<span class="token punctuation">)</span>        <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> mArcRadius<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">//使用Matrix旋转,位移图片</span>
matrix<span class="token punctuation">.</span><span class="token function">postTranslate</span><span class="token punctuation">(</span>transX<span class="token punctuation">,</span> transY<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">postRotate</span><span class="token punctuation">(</span><span class="token keyword">float</span> degrees<span class="token punctuation">,</span> <span class="token keyword">float</span> px<span class="token punctuation">,</span> <span class="token keyword">float</span> py<span class="token punctuation">)</span><span class="token punctuation">;</span>
canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>mLeafBitmap<span class="token punctuation">,</span> matrix<span class="token punctuation">,</span> mBitmapPaint<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="第六章-UI-布局"><a href="#第六章-UI-布局" class="headerlink" title="第六章 UI 布局"></a>第六章 UI 布局</h1><h2 id="MeasureSpec-常用方法"><a href="#MeasureSpec-常用方法" class="headerlink" title="MeasureSpec 常用方法"></a>MeasureSpec 常用方法</h2><ul>
<li>MeasureSpec类中的三个Mode常量值的意义<br>UNSPECIFIED 表示未指定<br>EXACTLY 老爸已经指定好<br>AT_MOST 表示至多，有一个最大限制</li>
<li>获取Mode，int mode = MeasureSpec.getMode(heightMeasureSpec); </li>
<li>int size = MeasureSpec.getSize(measureSpec);  获得实际大小</li>
<li>int childWidthSpec = MeasureSpec.makeMeasureSpec(width, MeasureSpec.UNSPECIFIED);</li>
<li>measureChildren /measureChild/measureChildWithMargins</li>
<li>setMeasuredDimension()  设置最终测量值</li>
<li>API 11 以前 使用 resolveSize ，以后使用 resolveSizeAndState<pre class="line-numbers language-java"><code class="language-java"><span class="token function">setMeasuredDimension</span><span class="token punctuation">(</span>
<span class="token function">resolveSizeAndState</span><span class="token punctuation">(</span>maxWidth<span class="token punctuation">,</span> widthMeasureSpec<span class="token punctuation">,</span> childState <span class="token operator">&lt;&lt;</span> MEASURED_HEIGHT_STATE_SHIFT<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token function">resolveSizeAndState</span><span class="token punctuation">(</span>maxHeight<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">,</span> childState <span class="token operator">&lt;&lt;</span> MEASURED_HEIGHT_STATE_SHIFT<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token keyword">int</span> width <span class="token operator">=</span> <span class="token function">resolveSize</span><span class="token punctuation">(</span><span class="token function">getSuggestedMinimumWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">final</span> <span class="token keyword">int</span> height <span class="token operator">=</span> <span class="token function">resolveSize</span><span class="token punctuation">(</span><span class="token function">getSuggestedMinimumHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
</ul>
<h2 id="ViewGroup-View"><a href="#ViewGroup-View" class="headerlink" title="ViewGroup/View"></a>ViewGroup/View</h2><p><img src="http://upload-images.jianshu.io/upload_images/1321512-28dbe5083f4f1c2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><img src="http://upload-images.jianshu.io/upload_images/1321512-bb097e636dd027e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<ul>
<li>shouldDelayChildPressedState 自定义ViewGroup 为不滚动Group返回false；</li>
<li>Gravity.apply(int gravity, int w, int h, Rect container, Rect outRect)<br>第一个参数表示我们的对其方式值，第二三个参数呢则表示我们要对齐的元素，这里通俗地说就是我们父容器下的子元素，而container参数表示的则是我们父容器的矩形区域，最后一个参数是接收计算后子元素位置区域的矩形对象，随便new个传进去就行，可见apply方式是根据矩形区域来计算对其方式的，所以说非常好用，我们只需在onLayout方法中确定出父容器的矩形区域就可以轻松地计算出子元素根据对其方式出现在父容器中的矩形区域，这一个过程留给大家自行尝试. </li>
</ul>
<h2 id="触摸反馈"><a href="#触摸反馈" class="headerlink" title="触摸反馈"></a>触摸反馈</h2><p><a href="https://blog.csdn.net/lovelease/article/details/81137071" target="_blank" rel="noopener">Android的事件分发机制以及滑动冲突的解决</a></p>
<h2 id="坐标"><a href="#坐标" class="headerlink" title="坐标"></a>坐标</h2><ul>
<li><strong>getGlobalVisibleRect方法的作用是获取视图在屏幕坐标中的可视区域</strong></li>
<li><strong>getLocalVisibleRect的作用是获取视图本身可见的坐标区域，坐标以自己的左上角为原点（0，0）</strong></li>
<li>view.getLocationInWindow(location); //获取在当前窗口内的绝对坐标</li>
<li>view.getLocationOnScreen(location); //获取在整个屏幕内的绝对坐标</li>
<li><a href="http://blog.csdn.net/ztp800201/article/details/17218067" target="_blank" rel="noopener">MotionEvent中getX()和getRawX()的区别</a>  getRowX：触摸点相对于屏幕的坐标  getX： 触摸点相对于按钮的坐标</li>
</ul>
<p>参考：</p>
<ul>
<li><a href="http://www.cnblogs.com/ai-developers/p/4413585.html" target="_blank" rel="noopener">getGlobalVisibleRect和getLocalVisibleRect</a></li>
<li><a href="https://blog.csdn.net/lvxiangan/article/details/19971509" target="_blank" rel="noopener">android坐标</a></li>
</ul>
<h3 id="获取View位置"><a href="#获取View位置" class="headerlink" title="获取View位置"></a>获取View位置</h3><p><img src="http://cdn.linz.tech/android_view_location.png" alt></p>
<p>屏幕分辨率为1080x2160</p>
<pre class="line-numbers language-kotlin"><code class="language-kotlin"><span class="token keyword">var</span> rect <span class="token operator">=</span> <span class="token function">Rect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
view<span class="token punctuation">.</span><span class="token function">getGlobalVisibleRect</span><span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
rect<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>getHitRect/getGlobalVisibleRect -&gt; Rect(882, 1764 - 1036, 1918)</p>
</li>
<li><p>getDrawingRect/getLocalVisibleRect -&gt; Rect(0, 0 - 154, 154)</p>
</li>
</ul>
<h1 id="附录一"><a href="#附录一" class="headerlink" title="附录一"></a>附录一</h1><h2 id="参考博文"><a href="#参考博文" class="headerlink" title="参考博文"></a>参考博文</h2><p><a href="https://blog.csdn.net/unicorn97/article/details/80796234#ConstraintLayoutConstraintSet_329" target="_blank" rel="noopener">Android动画大合集</a></p>
<p><a href="https://blog.csdn.net/aigestudio/article/list/2?t=1&amp;" target="_blank" rel="noopener">定义View 其实很简单</a></p>
<h3 id="Canvas"><a href="#Canvas" class="headerlink" title="Canvas"></a>Canvas</h3><ul>
<li><a href="https://www.jianshu.com/p/550d85419121" target="_blank" rel="noopener">Android画布剪裁函数clipRect详解</a></li>
<li><a href="https://blog.csdn.net/tiankongcheng6/article/details/83000247" target="_blank" rel="noopener">Android canvas.save()与canvas.restore()的使用总结</a></li>
<li><a href="https://blog.csdn.net/chen930724/article/details/50176661" target="_blank" rel="noopener">Android  draw canvas save restore saveLayer 学习</a></li>
</ul>
<h3 id="Style"><a href="#Style" class="headerlink" title="Style"></a>Style</h3><ul>
<li><p><a href="https://www.cnblogs.com/angeldevil/p/3479431.html" target="_blank" rel="noopener">Android中自定义样式与View的构造函数中的第三个参数defStyle的意义</a></p>
</li>
<li><p><a href="https://www.jianshu.com/p/f1fd2d8d5536" target="_blank" rel="noopener">Android中Attributes、defStyleAttr、defStyleRes关系理解与应用</a></p>
</li>
</ul>
<h2 id="图片处理"><a href="#图片处理" class="headerlink" title="图片处理"></a>图片处理</h2><h3 id="开源库"><a href="#开源库" class="headerlink" title="开源库"></a>开源库</h3><ul>
<li><a href="https://github.com/chengdazhi/StyleImageView" target="_blank" rel="noopener">StyleImageView</a><br><img src="https://raw.githubusercontent.com/chengdazhi/StyleImageView/master/images/style_sample.gif" alt></li>
</ul>
<h1 id="附录二"><a href="#附录二" class="headerlink" title="附录二"></a>附录二</h1><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><h3 id="Matrix"><a href="#Matrix" class="headerlink" title="Matrix"></a>Matrix</h3><p><img src="http://upload-images.jianshu.io/upload_images/1321512-02b7186177129852.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<blockquote>
<p>除了平移外，缩放、旋转、错切、透视都是需要一个中心点作为参照的，如果没有平移，默认为图形的[0,0]点，平移只需要指定移动的距离即可，平移操作会改变中心点的位置！非常重要！记牢了！</p>
</blockquote>
<ul>
<li>而preXXX和postXXX就是分别表示矩阵的左右乘,左右乘的结果是不同的。</li>
<li>平移left个单位↓平移top个单位，也就是说原本shader的原点应该是画布，不是屏幕。</li>
</ul>
<h2 id="仿写练习"><a href="#仿写练习" class="headerlink" title="仿写练习"></a>仿写练习</h2><p><a href="https://hencoder.com/activity-mock-2/" target="_blank" rel="noopener">https://hencoder.com/activity-mock-2/</a></p>
<p><strong>即刻仿写</strong>： <a href="https://insight.io/github.com/arvinljw/ThumbUpSample/tree/master/" target="_blank" rel="noopener">https://insight.io/github.com/arvinljw/ThumbUpSample/tree/master/</a><br>关于仿写者刘金伟：<br>github： <a href="https://github.com/arvinljw" target="_blank" rel="noopener">https://github.com/arvinljw</a><br>简书： <a href="http://www.jianshu.com/u/8fcc3372beb7" target="_blank" rel="noopener">http://www.jianshu.com/u/8fcc3372beb7</a></p>
<p><strong>薄荷健康仿写</strong>： <a href="https://insight.io/github.com/totond/BooheeRuler/tree/master/" target="_blank" rel="noopener">https://insight.io/github.com/totond/BooheeRuler/tree/master/</a><br>关于仿写者严积楷：<br>github： <a href="https://github.com/totond" target="_blank" rel="noopener">https://github.com/totond</a><br>CSDN： <a href="http://blog.csdn.net/totond" target="_blank" rel="noopener">http://blog.csdn.net/totond</a><br>邮箱： <a href="mailto:yanzhikai_yjk@qq.com" target="_blank" rel="noopener">yanzhikai_yjk@qq.com</a></p>
<p><strong>小米运动仿写</strong>： <a href="https://insight.io/github.com/SickWorm/MISportsConnectWidget/tree/master/" target="_blank" rel="noopener">https://insight.io/github.com/SickWorm/MISportsConnectWidget/tree/master/</a><br>关于仿写者陈浩：<br>github： <a href="https://github.com/SickWorm" target="_blank" rel="noopener">https://github.com/SickWorm</a></p>
<p><strong>Flipboard 仿写</strong>： <a href="https://insight.io/github.com/sunnyxibei/HenCoderPractice/tree/master/" target="_blank" rel="noopener">https://insight.io/github.com/sunnyxibei/HenCoderPractice/tree/master/</a><br>关于仿写者贾元斌：<br>github： <a href="https://github.com/sunnyxibei" target="_blank" rel="noopener">https://github.com/sunnyxibei</a><br>微博： <a href="https://weibo.com/812306989" target="_blank" rel="noopener">https://weibo.com/812306989</a><br>微信： sun521xibei<br>个人博客： <a href="http://timeriver.com.cn/" target="_blank" rel="noopener">http://timeriver.com.cn/</a></p>
<h2 id="自定义View其实很简单案例"><a href="#自定义View其实很简单案例" class="headerlink" title="自定义View其实很简单案例"></a>自定义View其实很简单案例</h2><ul>
<li><p><a href="http://blog.csdn.net/aigestudio/article/details/41316141" target="_blank" rel="noopener">自定义控件其实很简单1/6</a><br><img src="http://upload-images.jianshu.io/upload_images/1321512-e7aad3fae62f26d8.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
</li>
<li><p><a href="http://blog.csdn.net/aigestudio/article/details/41799811" target="_blank" rel="noopener">自定义控件其实很简单1/3</a><br><img src="http://upload-images.jianshu.io/upload_images/1321512-801e00469b2602c1.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br><code>mRefBitmap = Bitmap.createBitmap(mSrcBitmap, 0, 0, mSrcBitmap.getWidth(), mSrcBitmap.getHeight(), matrix, true);</code>createBitamp + matrix 得到图片的倒影图<br><img src="http://upload-images.jianshu.io/upload_images/1321512-40c2c0171a7c1892.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>核心代码</p>
<pre class="line-numbers language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 实例化混合模式  </span>
      mXfermode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PorterDuffXfermode</span><span class="token punctuation">(</span>PorterDuff<span class="token punctuation">.</span>Mode<span class="token punctuation">.</span>SCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 去饱和、提亮、色相矫正  </span>
mBitmapPaint<span class="token punctuation">.</span><span class="token function">setColorFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ColorMatrixColorFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">float</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span> <span class="token number">0.8587F</span><span class="token punctuation">,</span> <span class="token number">0.2940F</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">0.0927F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6.79F</span><span class="token punctuation">,</span> <span class="token number">0.0821F</span><span class="token punctuation">,</span> <span class="token number">0.9145F</span><span class="token punctuation">,</span> <span class="token number">0.0634F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6.79F</span><span class="token punctuation">,</span> <span class="token number">0.2019F</span><span class="token punctuation">,</span> <span class="token number">0.1097F</span><span class="token punctuation">,</span> <span class="token number">0.7483F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6.79F</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment" spellcheck="true">// 设置径向渐变，渐变中心当然是图片的中心也是屏幕中心，渐变半径我们直接拿图片的高度但是要稍微小一点  </span>
      <span class="token comment" spellcheck="true">// 中心颜色为透明而边缘颜色为黑色  </span>
      mShaderPaint<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RadialGradient</span><span class="token punctuation">(</span>screenW <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> screenH <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> mBitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">7</span> <span class="token operator">/</span> <span class="token number">8</span><span class="token punctuation">,</span> Color<span class="token punctuation">.</span>TRANSPARENT<span class="token punctuation">,</span> Color<span class="token punctuation">.</span>BLACK<span class="token punctuation">,</span> Shader<span class="token punctuation">.</span>TileMode<span class="token punctuation">.</span>CLAMP<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token annotation punctuation">@Override</span>  
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 新建图层  </span>
      <span class="token keyword">int</span> sc <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">saveLayer</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> mBitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+</span> mBitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> Canvas<span class="token punctuation">.</span>ALL_SAVE_FLAG<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 绘制混合颜色  </span>
      canvas<span class="token punctuation">.</span><span class="token function">drawColor</span><span class="token punctuation">(</span><span class="token number">0xcc1c093e</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 设置混合模式  </span>
      mBitmapPaint<span class="token punctuation">.</span><span class="token function">setXfermode</span><span class="token punctuation">(</span>mXfermode<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 绘制位图  </span>
      canvas<span class="token punctuation">.</span><span class="token function">drawBitmap</span><span class="token punctuation">(</span>mBitmap<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> mBitmapPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 还原混合模式  </span>
      mBitmapPaint<span class="token punctuation">.</span><span class="token function">setXfermode</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 还原画布  </span>
      canvas<span class="token punctuation">.</span><span class="token function">restoreToCount</span><span class="token punctuation">(</span>sc<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 绘制一个跟图片大小一样的矩形  </span>
      canvas<span class="token punctuation">.</span><span class="token function">drawRect</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> x <span class="token operator">+</span> mBitmap<span class="token punctuation">.</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> y <span class="token operator">+</span> mBitmap<span class="token punctuation">.</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mShaderPaint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>Matrix ImageView中的应用<br><img src="http://upload-images.jianshu.io/upload_images/1321512-fa91852954be9f0f.gif?imageMogr2/auto-orient/strip" alt></p>
</li>
<li><p>Matrix 在ListView中的应用<br><img src="http://upload-images.jianshu.io/upload_images/1321512-5030edba20a127c9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<pre class="line-numbers language-java"><code class="language-java">  <span class="token annotation punctuation">@Override</span>  
  <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
      mCamera<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      mCamera<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      mCamera<span class="token punctuation">.</span><span class="token function">getMatrix</span><span class="token punctuation">(</span>mMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      mMatrix<span class="token punctuation">.</span><span class="token function">preTranslate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      mMatrix<span class="token punctuation">.</span><span class="token function">postTranslate</span><span class="token punctuation">(</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      canvas<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>mMatrix<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      mCamera<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>自定义View<br><img src="http://upload-images.jianshu.io/upload_images/1321512-41c26887d58f3f4f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt><br>关键代码：</p>
<pre class="line-numbers language-java"><code class="language-java"> canvas<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 平移和旋转画布  </span>
      canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span>ccX<span class="token punctuation">,</span> ccY<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      canvas<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 依次画：(间隔)线(间隔)-圈  </span>
      canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>largeCricleRadiu <span class="token operator">-</span> space<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>lineLength <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> space<span class="token punctuation">,</span> strokePaint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>lineLength <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">-</span> smallCricleRadiu <span class="token operator">-</span> space <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> smallCricleRadiu<span class="token punctuation">,</span> strokePaint<span class="token punctuation">)</span><span class="token punctuation">;</span>  
      <span class="token comment" spellcheck="true">// 释放画布  </span>
      canvas<span class="token punctuation">.</span><span class="token function">restore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</li>
<li><p>View Path/Canvas的综合应用  <a href="http://blog.csdn.net/aigestudio/article/details/41960507" target="_blank" rel="noopener">5/12</a><br><img src="http://upload-images.jianshu.io/upload_images/1321512-7c44d124a04d43e2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
</li>
<li><p>翻页<br><a href="http://blog.csdn.net/aigestudio/article/details/42678541" target="_blank" rel="noopener">翻页（1）</a><br><img src="http://upload-images.jianshu.io/upload_images/1321512-fab59160fd493e92.gif?imageMogr2/auto-orient/strip" alt="翻页-1"></p>
</li>
</ul>
<p>难点未理解：折叠区域图片的绘制。</p>
<pre class="line-numbers language-java"><code class="language-java">canvas<span class="token punctuation">.</span><span class="token function">rotate</span><span class="token punctuation">(</span><span class="token number">90</span> <span class="token operator">-</span> mDegrees<span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>mViewHeight<span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">scale</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span>mViewWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="http://upload-images.jianshu.io/upload_images/1321512-f0e11fa6b7745197.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1321512-e553f979470b591c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<ul>
<li>drawBitmapMesh <a href="http://blog.csdn.net/aigestudio/article/details/41960507" target="_blank" rel="noopener">自定义控件其实很简单5/12</a></li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/1321512-367aeaac082c40a1.gif?imageMogr2/auto-orient/strip" alt="20141216152332401.gif"></p>
<h2 id="优秀博文"><a href="#优秀博文" class="headerlink" title="优秀博文"></a>优秀博文</h2><ul>
<li><a href="https://mp.weixin.qq.com/s/qqoBLsjU69YpWjkzBGgM_w?utm_source=androidweekly.io&amp;utm_medium=website" target="_blank" rel="noopener">如何实现图片的扭曲效果，窗帘效果及仿真水波纹效果，修图技术之瘦身瘦脸效果的实现(android-drawBitmapMesh)</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Android/" rel="tag"># Android</a>
          
            <a href="/tags/UI/" rel="tag"># UI</a>
          
            <a href="/tags/知识架构/" rel="tag"># 知识架构</a>
          
            <a href="/tags/自定义View/" rel="tag"># 自定义View</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/09/14/2019-3-21-Java-basic/" rel="next" title="Java 语法及知识架构笔记；">
                <i class="fa fa-chevron-left"></i> Java 语法及知识架构笔记；
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/09/16/2019-9-16-circle-queue-LeetCode/" rel="prev" title="设计循环队列-LeetCode">
                设计循环队列-LeetCode <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  
    <div class="comments" id="comments">
      <div class="ds-thread" data-thread-key="2019/09/15/2019-9-15-custom_view_note/" data-title="自定义View知识架构体系" data-url="http://linz.tech/2019/09/15/2019-9-15-custom_view_note/">
      </div>
    </div>
  


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="http://cdn.linz.tech/a.gif" alt="北疆">
            
              <p class="site-author-name" itemprop="name">北疆</p>
              <p class="site-description motion-element" itemprop="description">自古以来，所谓豪杰之士，必有过人之节。人情有所不能忍着，匹夫见辱.拔剑而起.挺身而斗，此不足为勇也。天下有大勇者,猝然临之而不惊,无故加之而不怒。而其挟持者甚大，其志甚远也。 ——苏东坡《留候论》</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">87</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">35</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/Orange168" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://weibo.com/bonanzas" target="_blank" title="微博">
                    
                      <i class="fa fa-fw fa-globe"></i>微博</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="http://www.jianshu.com/users/53927a5b90c8/latest_articles" target="_blank" title="简书">
                    
                      <i class="fa fa-fw fa-globe"></i>简书</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                常用网站
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://androidweekly.net/" title="Androidweekly English" target="_blank">Androidweekly English</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://androidweekly.cn/" title="Androidweekly Chinese" target="_blank">Androidweekly Chinese</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#第一章-入门基本类熟悉"><span class="nav-number">1.</span> <span class="nav-text">第一章 入门基本类熟悉</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第1节-Canvas"><span class="nav-number">1.1.</span> <span class="nav-text">第1节 Canvas</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas-使用方法概述"><span class="nav-number">1.1.1.</span> <span class="nav-text">Canvas 使用方法概述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法举例"><span class="nav-number">1.1.2.</span> <span class="nav-text">方法举例</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Canvas-scale-float-sx-float-sy-float-px-float-py-放缩"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">Canvas.scale(float sx, float sy, float px, float py) 放缩</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#skew-float-sx-float-sy-错切"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">skew(float sx, float sy) 错切</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Matrix-来做自定义变换"><span class="nav-number">1.1.2.3.</span> <span class="nav-text">Matrix 来做自定义变换</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas图层的概念"><span class="nav-number">1.1.3.</span> <span class="nav-text">Canvas图层的概念</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第2节-Paint"><span class="nav-number">1.2.</span> <span class="nav-text">第2节 Paint</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#初始化类"><span class="nav-number">1.2.1.</span> <span class="nav-text">初始化类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reset-相当于重新-new-一个，不过性能当然高一些啦"><span class="nav-number">1.2.2.</span> <span class="nav-text">reset() 相当于重新 new 一个，不过性能当然高一些啦</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#set-Paint-src-属性全部复制过来"><span class="nav-number">1.2.3.</span> <span class="nav-text">set(Paint src) 属性全部复制过来</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#setFlags-int-flags"><span class="nav-number">1.2.4.</span> <span class="nav-text">setFlags(int flags)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#笔头属性"><span class="nav-number">1.2.5.</span> <span class="nav-text">笔头属性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Paint-setStyle-Paint-Style-style"><span class="nav-number">1.2.5.0.1.</span> <span class="nav-text">Paint.setStyle(Paint.Style style)</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Paint-setStrokeWidth-float-width-非填充模式下下，设置笔头（线条）粗细"><span class="nav-number">1.2.5.0.2.</span> <span class="nav-text">Paint.setStrokeWidth(float width) 非填充模式下下，设置笔头（线条）粗细</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#抗锯齿"><span class="nav-number">1.2.5.0.3.</span> <span class="nav-text">抗锯齿</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#笔锋属性及线条"><span class="nav-number">1.2.6.</span> <span class="nav-text">笔锋属性及线条</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#PathEffect"><span class="nav-number">1.2.6.1.</span> <span class="nav-text">PathEffect</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#CornerPathEffect-拐角变成圆角-可以将路径的转角变得圆滑"><span class="nav-number">1.2.6.2.</span> <span class="nav-text">CornerPathEffect 拐角变成圆角 可以将路径的转角变得圆滑</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DiscretePathEffect-把线条进行随机的偏离"><span class="nav-number">1.2.6.3.</span> <span class="nav-text">DiscretePathEffect 把线条进行随机的偏离</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#DashPathEffect-虚线来绘制线条"><span class="nav-number">1.2.6.4.</span> <span class="nav-text">DashPathEffect 虚线来绘制线条</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PathDashPathEffect-用一个-Path-来绘制「虚线」"><span class="nav-number">1.2.6.5.</span> <span class="nav-text">PathDashPathEffect 用一个 Path 来绘制「虚线」</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SumPathEffect-分别单独绘制"><span class="nav-number">1.2.6.6.</span> <span class="nav-text">SumPathEffect 分别单独绘制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ComposePathEffect-叠加绘制"><span class="nav-number">1.2.6.7.</span> <span class="nav-text">ComposePathEffect 叠加绘制</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#StrokeMiter"><span class="nav-number">1.2.6.8.</span> <span class="nav-text">StrokeMiter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#文本绘制属性"><span class="nav-number">1.2.7.</span> <span class="nav-text">文本绘制属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#FontMetrics"><span class="nav-number">1.2.7.1.</span> <span class="nav-text">FontMetrics</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#笔头着色属性"><span class="nav-number">1.2.8.</span> <span class="nav-text">笔头着色属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setShader-Shader-shader"><span class="nav-number">1.2.8.1.</span> <span class="nav-text">setShader(Shader shader)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#BitmapShader-用-Bitmap-的像素来作为图形或文字的填充"><span class="nav-number">1.2.8.1.1.</span> <span class="nav-text">BitmapShader 用 Bitmap 的像素来作为图形或文字的填充</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LinearGradient-线性渐变"><span class="nav-number">1.2.8.1.2.</span> <span class="nav-text">LinearGradient 线性渐变</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#RadialGradient-辐射渐变"><span class="nav-number">1.2.8.1.3.</span> <span class="nav-text">RadialGradient 辐射渐变</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#SweepGradient-扫描渐变"><span class="nav-number">1.2.8.1.4.</span> <span class="nav-text">SweepGradient 扫描渐变</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#setColorFilter-ColorFilter-colorFilter"><span class="nav-number">1.2.8.2.</span> <span class="nav-text">setColorFilter(ColorFilter colorFilter)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PorterDuffColorFilter-int-color-PorterDuff-Mode-mode-使用一个指定的颜色和一种指定的-PorterDuff-Mode-来与绘制对象进行合成"><span class="nav-number">1.2.8.3.</span> <span class="nav-text">PorterDuffColorFilter (int color, PorterDuff.Mode mode) 使用一个指定的颜色和一种指定的 PorterDuff.Mode 来与绘制对象进行合成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ColorMatrixColorFilter"><span class="nav-number">1.2.8.4.</span> <span class="nav-text">ColorMatrixColorFilter</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#合成-Xfermode"><span class="nav-number">1.2.9.</span> <span class="nav-text">合成 Xfermode</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#setMaskFilter"><span class="nav-number">1.2.9.1.</span> <span class="nav-text">setMaskFilter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BlurMaskFilter"><span class="nav-number">1.2.9.2.</span> <span class="nav-text">BlurMaskFilter</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EmbossMaskFilter-浮雕效果"><span class="nav-number">1.2.9.3.</span> <span class="nav-text">EmbossMaskFilter 浮雕效果</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第3节-Path"><span class="nav-number">1.3.</span> <span class="nav-text">第3节 Path</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第4节-Camera-【了解】"><span class="nav-number">1.4.</span> <span class="nav-text">第4节 Camera 【了解】</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-rotate-三维旋转"><span class="nav-number">1.4.1.</span> <span class="nav-text">Camera.rotate*() 三维旋转</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-translate-float-x-float-y-float-z-移动"><span class="nav-number">1.4.2.</span> <span class="nav-text">Camera.translate(float x, float y, float z) 移动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Camera-setLocation-x-y-z-设置虚拟相机的位置"><span class="nav-number">1.4.3.</span> <span class="nav-text">Camera.setLocation(x, y, z) 设置虚拟相机的位置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#View绘制流程"><span class="nav-number">1.5.</span> <span class="nav-text">View绘制流程</span></a></li></ol><li class="nav-item nav-level-1"><a class="nav-link" href="#第二章-初学易犯错误"><span class="nav-number">2.</span> <span class="nav-text">第二章 初学易犯错误</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#构造方法缺失"><span class="nav-number">2.1.</span> <span class="nav-text">构造方法缺失</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#属性继承"><span class="nav-number">2.2.</span> <span class="nav-text">属性继承</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#drawText-坐标错误"><span class="nav-number">2.3.</span> <span class="nav-text">drawText 坐标错误</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#drawText-String-text-float-x-float-y-Paint-paint-（x-y）指如下："><span class="nav-number">2.3.1.</span> <span class="nav-text">drawText(String text, float x, float y, Paint paint) ,（x, y）指如下：</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#不知道不会用硬件加速"><span class="nav-number">2.4.</span> <span class="nav-text">不知道不会用硬件加速</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#什么是硬件加速"><span class="nav-number">2.4.1.</span> <span class="nav-text">什么是硬件加速</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一句话：用GPU绘制View"><span class="nav-number">2.5.</span> <span class="nav-text">一句话：用GPU绘制View</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#理解：现在很多主流手机机型都会有GPU，甚至比一些电脑的配置都高。手机和电脑硬件架构基本类似，不开启和开启硬件加速，就像集显和有1G显卡的不同，程序员应该秒懂。"><span class="nav-number">2.5.1.</span> <span class="nav-text">理解：现在很多主流手机机型都会有GPU，甚至比一些电脑的配置都高。手机和电脑硬件架构基本类似，不开启和开启硬件加速，就像集显和有1G显卡的不同，程序员应该秒懂。</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#怎么开启"><span class="nav-number">2.5.2.</span> <span class="nav-text">怎么开启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用条件"><span class="nav-number">2.5.3.</span> <span class="nav-text">使用条件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Canvas-调用以上方法需要检测系统API"><span class="nav-number">2.6.</span> <span class="nav-text">Canvas` 调用以上方法需要检测系统API</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#这种方式不适用于基于自定义属性绘制的动画"><span class="nav-number">2.7.</span> <span class="nav-text">　这种方式不适用于基于自定义属性绘制的动画</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第三章-怎么向自定义View传参"><span class="nav-number">3.</span> <span class="nav-text">第三章 怎么向自定义View传参</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#第1节-最简单案例"><span class="nav-number">3.1.</span> <span class="nav-text">第1节 最简单案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第2节-8种基本类型传参（format）"><span class="nav-number">3.2.</span> <span class="nav-text">第2节 8种基本类型传参（format）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第3节-单选，多选混合传参"><span class="nav-number">3.3.</span> <span class="nav-text">第3节 单选，多选混合传参</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第四章-控件默认Style从那来的？Theme原理"><span class="nav-number">4.</span> <span class="nav-text">第四章 控件默认Style从那来的？Theme原理</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Theme原理"><span class="nav-number">4.1.</span> <span class="nav-text">Theme原理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#设置属性的5等级"><span class="nav-number">4.2.</span> <span class="nav-text">设置属性的5等级</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#获取Style常用方法"><span class="nav-number">4.3.</span> <span class="nav-text">获取Style常用方法</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第五章-View-动画（属性的修改）"><span class="nav-number">5.</span> <span class="nav-text">第五章 View 动画（属性的修改）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#View-动画的本质是一定时间段内动态的改变View的一个或多个属性，以达到动画的效果"><span class="nav-number">5.1.</span> <span class="nav-text">View 动画的本质是一定时间段内动态的改变View的一个或多个属性，以达到动画的效果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#三个关键要素"><span class="nav-number">5.1.1.</span> <span class="nav-text">三个关键要素</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第1节-改变属性"><span class="nav-number">5.2.</span> <span class="nav-text">第1节 改变属性</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#最小案例"><span class="nav-number">5.2.1.</span> <span class="nav-text">最小案例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第2节-改变方式"><span class="nav-number">5.3.</span> <span class="nav-text">第2节 改变方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-Interpolator"><span class="nav-number">5.3.1.</span> <span class="nav-text">2.1 Interpolator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-自定义-Evaluator"><span class="nav-number">5.3.2.</span> <span class="nav-text">2.2 自定义 Evaluator</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#给起始值和进行的百分比，想要什么值自己定算法"><span class="nav-number">5.4.</span> <span class="nav-text">给起始值和进行的百分比，想要什么值自己定算法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-一次改变多个属性"><span class="nav-number">5.4.1.</span> <span class="nav-text">2.3 一次改变多个属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-多属性改变设置顺序"><span class="nav-number">5.4.2.</span> <span class="nav-text">2.4 多属性改变设置顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-5-同一个属性关键帧拆分"><span class="nav-number">5.4.3.</span> <span class="nav-text">2.5 同一个属性关键帧拆分</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第3节-监听改变"><span class="nav-number">5.5.</span> <span class="nav-text">第3节 监听改变</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#第4节-实战笔记"><span class="nav-number">5.6.</span> <span class="nav-text">第4节 实战笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Tween-Animation"><span class="nav-number">5.6.1.</span> <span class="nav-text">4.1 Tween Animation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-Frame-Animation"><span class="nav-number">5.6.2.</span> <span class="nav-text">4.2 Frame Animation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Spring-Animation"><span class="nav-number">5.6.3.</span> <span class="nav-text">4.3 Spring Animation</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CustomView案例笔记"><span class="nav-number">5.6.3.1.</span> <span class="nav-text">CustomView案例笔记</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#第六章-UI-布局"><span class="nav-number">6.</span> <span class="nav-text">第六章 UI 布局</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MeasureSpec-常用方法"><span class="nav-number">6.1.</span> <span class="nav-text">MeasureSpec 常用方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ViewGroup-View"><span class="nav-number">6.2.</span> <span class="nav-text">ViewGroup/View</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#触摸反馈"><span class="nav-number">6.3.</span> <span class="nav-text">触摸反馈</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#坐标"><span class="nav-number">6.4.</span> <span class="nav-text">坐标</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#获取View位置"><span class="nav-number">6.4.1.</span> <span class="nav-text">获取View位置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附录一"><span class="nav-number">7.</span> <span class="nav-text">附录一</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#参考博文"><span class="nav-number">7.1.</span> <span class="nav-text">参考博文</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Canvas"><span class="nav-number">7.1.1.</span> <span class="nav-text">Canvas</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Style"><span class="nav-number">7.1.2.</span> <span class="nav-text">Style</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#图片处理"><span class="nav-number">7.2.</span> <span class="nav-text">图片处理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#开源库"><span class="nav-number">7.2.1.</span> <span class="nav-text">开源库</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#附录二"><span class="nav-number">8.</span> <span class="nav-text">附录二</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#知识点"><span class="nav-number">8.1.</span> <span class="nav-text">知识点</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Matrix"><span class="nav-number">8.1.1.</span> <span class="nav-text">Matrix</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#仿写练习"><span class="nav-number">8.2.</span> <span class="nav-text">仿写练习</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#自定义View其实很简单案例"><span class="nav-number">8.3.</span> <span class="nav-text">自定义View其实很简单案例</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#优秀博文"><span class="nav-number">8.4.</span> <span class="nav-text">优秀博文</span></a></li></ol></li></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">北疆</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>





    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人</span>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zhilinchn"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  
















  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === '') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  

</body>
</html>
